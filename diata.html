<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Heli 1200 Dark - Ultimate Fixed</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg: #121212; --card: #1e1e1e; --text: #e0e0e0; --accent: #4dabf7; --success: #00e676; --danger: #ff5252; --border: #333; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px 10px 100px 10px; }
        .stats-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; position: sticky; top: 5px; z-index: 900; background: var(--bg); padding-bottom: 10px; }
        .stat-box { background: #252525; padding: 10px; border-radius: 12px; text-align: center; border: 1px solid var(--border); box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .stat-val { font-size: 1.3rem; font-weight: bold; display: block; }
        .card { background: var(--card); border-radius: 16px; padding: 15px; margin-bottom: 15px; border: 1px solid var(--border); }
        h3 { color: var(--accent); margin: 0 0 10px 0; border-bottom: 1px solid #333; padding-bottom: 8px; display: flex; justify-content: space-between; }
        select, input { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--border); background: #2c2c2c; color: #fff; font-size: 16px; margin-bottom: 12px; }
        button { cursor: pointer; }
        .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #1a1a1a; padding: 12px; display: flex; gap: 10px; border-top: 1px solid #333; z-index: 1000; }
        .nav-btn { flex: 1; background: #333; color: var(--text); padding: 12px; border-radius: 8px; border: none; font-weight: bold; }
        .del-btn { background: none; border: none; font-size: 1.2rem; cursor: pointer; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9rem; }
        td, th { padding: 8px; border-bottom: 1px solid #333; text-align: right; }
    </style>
</head>
<body>

<div class="stats-row">
    <div class="stat-box">
        <span style="font-size:0.8rem; color:#aaa">×§×œ×•×¨×™×•×ª</span>
        <span id="cal-count" class="stat-val" style="color:var(--accent)">0</span>
    </div>
    <div class="stat-box">
        <span style="font-size:0.8rem; color:#aaa">××©×§×œ</span>
        <span id="last-weight" class="stat-val">--</span>
    </div>
    <div class="stat-box" style="border:1px solid var(--success)">
        <span style="font-size:0.8rem; color:#aaa">×¡×”×´×› ×™×¨×™×“×”</span>
        <span id="total-lost" class="stat-val" style="color:var(--success)">0</span>
    </div>
</div>

<div id="app"></div>

<div class="card">
    <h3>ğŸ“‰ ××¨×›×™×•×Ÿ ××©×§×œ</h3>
    <div style="display:flex; gap:10px;">
        <input type="number" id="w-in" step="0.1" placeholder="×§×´×’" style="flex:1">
        <button onclick="addW()" style="background:var(--success); border:none; border-radius:8px; padding:0 20px; font-weight:bold;">×©××•×¨</button>
    </div>
    <canvas id="wChart" style="max-height:180px; width:100%; margin:15px 0;"></canvas>
    <div style="max-height:200px; overflow-y:auto;">
        <table>
            <tbody id="w-history-body"></tbody>
        </table>
    </div>
</div>

<div class="nav-bar">
    <button class="nav-btn" onclick="changeDate(-1)">â—„</button>
    <button class="nav-btn" onclick="openReport()">×¡×™×›×•×</button>
    <button class="nav-btn" onclick="changeDate(1)">â–º</button>
</div>

<div id="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:2000; justify-content:center; align-items:center;">
    <div style="background:var(--card); width:90%; max-height:85%; border-radius:15px; padding:20px; overflow-y:auto;">
        <h2 id="modal-title" style="text-align:center; color:var(--accent)"></h2>
        <div id="modal-body" style="color:#ccc; line-height:1.6"></div>
        <button onclick="document.getElementById('modal').style.display='none'" style="width:100%; margin-top:20px; background:var(--danger); color:white; padding:12px; border:none; border-radius:8px;">×¡×’×•×¨</button>
    </div>
</div>

<script>
const DB = {
    carbs: ["1 ×¤×™×ª×” ×§×œ×” (×¢×“ 80 ×§×œ×•×¨×™×•×ª)", "1 ×¤×¨×•×¡×ª ×œ×—× ×¨×’×™×œ", "2 ×¤×¨×•×¡×•×ª ×œ×—× ×§×œ", "1/3 ×¤×™×ª×” ×¨×’×™×œ×”", "1 ×œ×—×× ×™×™×” ×§×œ×”", "30 ×’×¨× ×œ×—×× ×™×™×”", "1/2 ××¦×”", "1 ××¦×” ×§×œ×”", "3 ×¤×ª×™×ª", "3 ×§×¨×§×¨×™× ×“×’× ×™×ª", "2 ×¤×™×¨×›×™×•×ª ××•×¨×–/×©×•×¢×œ", "10 ×¤×™×¨×›×™×•×ª ×‘×™×¡", "1/2 ×˜×•×¨×˜×™×”", "1 ×¢×œ×” ×¡×™×’×¨ ×’×“×•×œ", "5 ×“×¤×™ ××•×¨×–", "2 ×›×¤×•×ª ×§××—/×¡×•×œ×ª", "1/2 ×›×•×¡ ××•×¨×–/×¤×¡×˜×”/×¤×ª×™×ª×™× (××‘×•×©×œ)", "1 ×ª×¤×•×— ××“××” ×‘×™× ×•× ×™", "1/2 ×‘×˜×˜×” ×§×˜× ×”", "1 ×§×œ×— ×ª×™×¨×¡", "3/4 ×›×•×¡ ×ª×™×¨×¡ ×§×œ", "1 ×©×§×™×ª ×‘××‘×” ×§×˜× ×” (15×’)", "×©×§×™×ª ×¤×•×¤×§×•×¨×Ÿ (100 ×§×œ)", "2 ×›×•×¡×•×ª ×¤×•×¤×§×•×¨×Ÿ ×‘×™×ª×™", "10 ×‘×™×™×’×œ×” ×§×˜×Ÿ", "1 ×©×§×™×ª ×¦'×™×¤×¡ ×§×™×“×¡", "2 ×¤×ª×™ ×‘×¨", "1 ×—×˜×™×£ ×× ×¨×’×™×” (100 ×§×œ)"],
    cheese: ["2 ×›×¤×•×ª ×’×‘×™× ×” 5%", "60 ×’×¨× ×‘×•×œ×’×¨×™×ª/×¦×¤×ª×™×ª 5%", "1 ×¤×¨×•×¡×ª ×¦×”×•×‘×” 9%", "2 ×¤×¨×•×¡×•×ª ×¦×”×•×‘×” ×“×§-×“×§", "1 ×¤×¨×•×¡×ª ×¦×”×•×‘×” 22% (×¤×¢× ×‘×™×•×)", "1 ××¢×“×Ÿ 0% (80 ×§×œ)", "1 ×™×•×’×•×¨×˜ 1.5%", "1 ×›×•×¡ ×—×œ×‘ 1%", "1 ×›×•×¡ ×—×œ×‘ ×¡×•×™×”", "1 ×‘×™×¦×”", "1/2 ×§×•×¤×¡×” ×˜×•× ×” ×‘××™×", "3 ×¤×œ××¤×œ ××¤×•×™", "80 ×’×¨× ×“×’ ××‘×•×©×œ", "60 ×’×¨× ×˜×•×¤×•"],
    meat: ["×—×–×” ×¢×•×£ (150×’ ×œ×¤× ×™/100×’ ××—×¨×™)", "×‘×§×¨ ×¨×–×”/×¢×’×œ/×¤×™×œ×”", "1/4 ×¢×•×£ ×œ×œ× ×¢×•×¨", "3 ×©×•×§×™ ×¢×•×£", "3 ×§×¦×™×¦×•×ª ×‘×§×¨", "×©×•×•××¨××” ×”×•×“×• (150×’)", "×“×’ ××¤×•×™ (200×’ ×œ×¤× ×™/150×’ ××—×¨×™)", "1.5 ×§×•×¤×¡××•×ª ×˜×•× ×” ×‘××™×", "1 ×§×•×¤×¡×ª ×˜×•× ×” ×‘×©××Ÿ (××¡×•× ×Ÿ)", "150 ×’×¨× ×˜×•×¤×•", "2 ×©× ×™×¦×œ ×˜×‘×¢×•×œ (×¢×“ ×¤×¢××™×™× ×‘×©×‘×•×¢)", "1 ×”××‘×•×¨×’×¨ (×¤×¢× ×‘×©×‘×•×¢)"],
    fruit: ["×ª×¤×•×—", "××’×¡", "×‘× × ×” ×§×˜× ×”", "×›×•×¡ ××‘×˜×™×—/××œ×•×Ÿ", "2 ×©×–×™×¤×™×", "××¤×¨×¡×§", "2 ×§×œ×× ×˜×™× ×•×ª", "2 ×ª××¨×™× ×™×‘×©×™×", "1 ×ª××¨ ××’'×”×•×œ", "×—×¦×™ ×× ×’×•", "×›×•×¡ ×¢× ×‘×™×"],
    fat: ["×›×¤×™×ª ×©××Ÿ", "×›×£ ×˜×—×™× ×” ××•×›× ×”", "×›×£ ××‘×•×§×“×•", "6 ×–×™×ª×™× ×§×˜× ×™×", "×›×£ ×—×•××•×¡", "7 ×©×§×“×™×", "3 ××’×•×–×™ ××œ×š", "10 ×‘×•×˜× ×™×", "×›×¤×™×ª ×—×××”", "×›×£ ××™×•× ×– ×§×œ"],
    half: ["×¤×¨×•×¡×ª ×¦×”×•×‘×” 5%", "×›×£ ×’×‘×™× ×” 5%", "×—×¦×™ ×¦×”×•×‘×” 9%", "30 ×’×¨× ×‘×•×œ×’×¨×™×ª", "×›×¤×™×ª ×—×•××•×¡", "×—×¦×™ ×›×•×¡ ×—×œ×‘ 1%", "1/4 ×˜×•× ×” ×‘××™×", "×—×¦×™ ×‘×™×¦×”", "2 ×¤×¡×˜×¨××”", "1.5 ×¤×œ××¤×œ ××¤×•×™", "×—×¦×™ ×›×•×¡ ×©×•×§×• 0%", "×—×¦×™ ×›×•×¡ ×’×œ×™×“×” ×“×™××˜", "××©×•×œ×© ××•×Ÿ ×‘×œ××Ÿ"]
};

const meals = [
    { n: "×‘×•×§×¨", c: 200, p: [{l:"×¤×—××™××”", d:DB.carbs}, {l:"×’×‘×™× ×”", d:DB.cheese}] },
    { n: "×‘×™× ×™×™×", c: 150, p: [{l:"×¤×¨×™", d:DB.fruit}, {l:"×©×•××Ÿ", d:DB.fat}] },
    { n: "×¦×”×¨×™×™×", c: 350, p: [{l:"×‘×©×¨", d:DB.meat}, {l:"×¤×—××™××”", d:DB.carbs}, {l:"×©×•××Ÿ", d:DB.fat}] },
    { n: "××—×”×´×¦", c: 150, p: [{l:"×¤×—××™××”", d:DB.carbs}, {l:"×¤×¨×™", d:DB.fruit}, {l:"×©×•××Ÿ", d:DB.fat}] },
    { n: "×¢×¨×‘", c: 250, p: [{l:"×¤×—××™××”", d:DB.carbs}, {l:"×’×‘×™× ×”", d:DB.cheese}, {l:"×—×¦×™ ×—×œ×‘×•×Ÿ", d:DB.half}, {l:"×©×•××Ÿ", d:DB.fat}] },
    { n: "×œ×™×œ×”", c: 100, p: [{l:"×’×‘×™× ×”", d:DB.cheese}, {l:"×¤×¨×™", d:DB.fruit}] }
];

let vDate = new Date();
let data = JSON.parse(localStorage.getItem('heli_v3_fixed')) || { days:{}, weights:[] };

function getK(d) { return d.toLocaleDateString('he-IL').replace(/\./g,'-'); }

function init() {
    const k = getK(vDate);
    const day = data.days[k] || {};
    
    document.getElementById('app').innerHTML = meals.map((m, i) => `
        <div class="card">
            <h3>${m.n} <span>${m.c} ×§×œ'</span></h3>
            ${m.p.map((part, pi) => `
                <select onchange="updM('${k}', '${i}_${pi}', this.value)" style="${day[i+'_'+pi] ? 'border-color:var(--success); color:var(--success);' : ''}">
                    <option value="">${part.l}...</option>
                    ${part.d.map(x => `<option value="${x}" ${day[i+'_'+pi]===x?'selected':''}>${x}</option>`).join('')}
                </select>
            `).join('')}
        </div>
    `).join('');
    calc();
    renderW();
}

function updM(k, id, val) {
    if(!data.days[k]) data.days[k] = {};
    if(val === "") delete data.days[k][id];
    else data.days[k][id] = val;
    save();
    init(); // Re-render to update border colors
}

function calc() {
    const k = getK(vDate);
    const day = data.days[k] || {};
    let t = 0;
    meals.forEach((m, i) => {
        let active = false;
        m.p.forEach((_, pi) => { if(day[i+'_'+pi]) active = true; });
        if(active) t += m.c;
    });
    document.getElementById('cal-count').innerText = t;
}

function addW() {
    const v = document.getElementById('w-in').value;
    if(!v) return;
    data.weights.push({id:Date.now(), d:getK(new Date()), w:parseFloat(v)});
    save(); document.getElementById('w-in').value=''; renderW();
}

function delW(id) {
    if(confirm('×œ××—×•×§?')) {
        data.weights = data.weights.filter(x => x.id !== id);
        save(); renderW();
    }
}

function renderW() {
    const sorted = [...data.weights].sort((a,b) => a.id - b.id);
    const list = document.getElementById('w-history-body');
    
    if(sorted.length) {
        const cur = sorted[sorted.length-1].w;
        const start = sorted[0].w;
        document.getElementById('last-weight').innerText = cur;
        const diff = (start - cur).toFixed(1);
        const el = document.getElementById('total-lost');
        el.innerText = diff > 0 ? "-"+diff : "+"+Math.abs(diff);
        el.style.color = diff > 0 ? "var(--success)" : "var(--danger)";
        if(diff==0) { el.innerText="0"; el.style.color="#aaa"; }
    }

    // Chart
    const ctx = document.getElementById('wChart').getContext('2d');
    if(window.ch) window.ch.destroy();
    window.ch = new Chart(ctx, {
        type: 'line',
        data: {
            labels: sorted.slice(-10).map(x=>x.d),
            datasets: [{data:sorted.slice(-10).map(x=>x.w), borderColor:'#4dabf7', backgroundColor:'rgba(77,171,247,0.1)', fill:true, tension:0.4}]
        },
        options: { plugins:{legend:{display:false}}, scales:{x:{display:false}, y:{grid:{color:'#333'}}} }
    });

    // List
    list.innerHTML = [...sorted].reverse().map(x => `
        <tr>
            <td>${x.d}</td>
            <td style="font-weight:bold; color:#fff">${x.w}</td>
            <td><button class="del-btn" onclick="delW(${x.id})" style="color:var(--danger)">ğŸ—‘ï¸</button></td>
        </tr>
    `).join('');
}

function save() { localStorage.setItem('heli_v3_fixed', JSON.stringify(data)); }
function changeDate(n) { vDate.setDate(vDate.getDate()+n); init(); }
function openReport() {
    const k = getK(vDate);
    const day = data.days[k] || {};
    let h = '';
    meals.forEach((m,i) => {
        h += `<div style="margin-bottom:10px; border-bottom:1px solid #333"><b>${m.n}</b><br>`;
        m.p.forEach((p,pi) => { if(day[i+'_'+pi]) h+=`<span style="color:#aaa">â€¢ ${p.l}: ${day[i+'_'+pi]}</span><br>`; });
        h += `</div>`;
    });
    document.getElementById('modal-title').innerText = k;
    document.getElementById('modal-body').innerHTML = h || '××™×Ÿ × ×ª×•× ×™×';
    document.getElementById('modal').style.display = 'flex';
}

init();
</script>
</body>
</html>
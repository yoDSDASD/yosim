<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Heli 1200 PRO Ultra</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* ×”×’×“×¨×ª ××©×ª× ×™× ×•×¢×™×¦×•×‘ ×‘×¡×™×¡×™ - Dark Mode */
        :root { 
            --bg: #0f172a; 
            --card: #1e293b; 
            --text: #f8fafc; 
            --text-muted: #94a3b8;
            --accent: #3b82f6; 
            --accent-glow: rgba(59, 130, 246, 0.4);
            --success: #10b981; 
            --danger: #ef4444; 
            --warning: #f59e0b;
            --border: #334155; 
            --radius: 16px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { font-family: 'Rubik', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 12px; padding-bottom: 90px; -webkit-font-smoothing: antialiased; }
        
        /* ×›×•×ª×¨×•×ª ×•×¡×˜×˜×™×¡×˜×™×§×” */
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .date-title { font-size: 1.2rem; font-weight: 700; margin: 0; }
        .streak-badge { background: rgba(245, 158, 11, 0.2); color: var(--warning); padding: 6px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: bold; display: flex; align-items: center; gap: 5px; border: 1px solid rgba(245, 158, 11, 0.3); }

        .header-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .stat-card { background: var(--card); padding: 12px; border-radius: var(--radius); text-align: center; border: 1px solid var(--border); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.2); }
        .stat-val { font-size: 1.4rem; font-weight: 700; color: var(--accent); line-height: 1.2; }
        .stat-label { font-size: 0.75rem; color: var(--text-muted); margin-top: 4px; }

        /* ×›×¨×˜×™×¡ ××™× */
        .water-card { background: linear-gradient(135deg, #172554 0%, #1e40af 100%); padding: 16px; border-radius: var(--radius); margin-bottom: 20px; color: white; border: 1px solid #1e3a8a; box-shadow: 0 4px 15px rgba(30, 64, 175, 0.3); }
        .water-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .progress-bg { background: rgba(255,255,255,0.15); height: 12px; border-radius: 10px; overflow: hidden; margin-bottom: 15px; }
        .progress-fill { height: 100%; background: #60a5fa; width: 0%; transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 0 10px rgba(96, 165, 250, 0.6); }
        .water-btns { display: flex; gap: 10px; }
        .water-btn { flex: 1; background: rgba(255,255,255,0.2); border: none; color: white; padding: 10px; border-radius: 10px; font-weight: 600; cursor: pointer; transition: background 0.2s; font-size: 0.9rem; }
        .water-btn:active { background: rgba(255,255,255,0.4); transform: scale(0.98); }

        /* ×›×¨×˜×™×¡ ××¨×•×—×” */
        .meal-card { background: var(--card); border-radius: var(--radius); padding: 16px; margin-bottom: 16px; border: 1px solid var(--border); transition: all 0.3s ease; position: relative; }
        .meal-card.active-now { border-color: var(--accent); box-shadow: 0 0 0 1px var(--accent), 0 0 15px var(--accent-glow); }
        .meal-card.completed { border-color: var(--success); background: rgba(16, 185, 129, 0.05); }
        
        .meal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 10px; }
        .meal-title-wrap { display: flex; align-items: center; gap: 8px; }
        .meal-title { font-weight: 700; font-size: 1.1rem; color: #fff; }
        .meal-time { font-size: 0.8rem; background: #334155; padding: 3px 8px; border-radius: 6px; color: #cbd5e1; font-family: monospace; letter-spacing: 0.5px; }
        .meal-cal { font-size: 0.85rem; color: var(--text-muted); font-weight: 500; }
        
        /* Inputs & Selects - ××•×ª×× ×œ××•×‘×™×™×œ */
        select, input { width: 100%; padding: 14px; border-radius: 12px; border: 1px solid var(--border); background: #0f172a; color: white; font-size: 16px; /* ××•× ×¢ ×–×•× ×‘××™×™×¤×•×Ÿ */ margin-bottom: 10px; appearance: none; transition: border-color 0.2s; }
        select:focus, input:focus { border-color: var(--accent); }
        label { font-size: 0.85rem; color: var(--text-muted); display: block; margin-bottom: 5px; margin-right: 2px; }

        /* ×× ×” ××•×ª×¨×ª */
        .cheat-meal-container { display: flex; align-items: center; justify-content: space-between; background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); padding: 12px 16px; border-radius: 12px; margin-bottom: 20px; }
        .cheat-switch { position: relative; display: inline-block; width: 52px; height: 28px; }
        .cheat-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #475569; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        input:checked + .slider { background-color: var(--warning); }
        input:checked + .slider:before { transform: translateX(24px); }

        /* × ×™×•×•×˜ ×ª×—×ª×•×Ÿ */
        .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(15, 23, 42, 0.95); padding: 10px 20px; display: flex; justify-content: space-between; border-top: 1px solid var(--border); backdrop-filter: blur(12px); z-index: 1000; padding-bottom: max(10px, env(safe-area-inset-bottom)); }
        .nav-btn { background: none; border: none; color: var(--text-muted); font-size: 0.75rem; display: flex; flex-direction: column; align-items: center; gap: 5px; padding: 5px 10px; cursor: pointer; transition: color 0.2s; }
        .nav-btn.active { color: var(--accent); }
        .nav-icon { font-size: 1.5rem; margin-bottom: 2px; }

        /* ××•×“××œ×™× */
        #modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:2000; align-items: flex-end; animation: fadeIn 0.2s; }
        .modal-content { background: var(--card); width: 100%; max-height: 85vh; border-radius: 24px 24px 0 0; padding: 25px; overflow-y: auto; border-top: 1px solid var(--border); animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1); box-shadow: 0 -10px 40px rgba(0,0,0,0.5); }
        
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ×¨×©×ª ×›×œ×™× */
        .tools-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 15px; }
        .tool-btn { background: #263346; border: 1px solid var(--border); color: #e2e8f0; padding: 16px; border-radius: 14px; font-size: 0.95rem; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 10px; transition: transform 0.1s, background 0.2s; }
        .tool-btn:active { transform: scale(0.98); background: #334155; }
        
        /* ×›×¤×ª×•×¨ ×¨××©×™ */
        .btn-primary { background: var(--accent); color: white; border: none; padding: 14px; border-radius: 12px; font-weight: 700; width: 100%; font-size: 1rem; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); cursor: pointer; }
        .btn-close { width:100%; padding:15px; margin-top:20px; background:transparent; border:1px solid var(--border); color:var(--text-muted); border-radius:12px; font-weight:600; cursor:pointer; }

        /* ×¡×¤×™× ×¨ ×œ×’×¨×£ */
        .chart-container { position: relative; height: 250px; width: 100%; margin-bottom: 15px; }
    </style>
</head>
<body>

<div class="header-top">
    <div>
        <div style="font-size:0.85rem; color:var(--text-muted);">×©×œ×•× ×™×•×¡×£</div>
        <h1 id="cur-date-display" class="date-title">--/--/----</h1>
    </div>
    <div id="streak-badge" class="streak-badge">
        <span>ğŸ”¥</span> <span id="streak-count">0</span> ×™××™×
    </div>
</div>

<div class="header-grid">
    <div class="stat-card">
        <div id="cal-val" class="stat-val">0</div>
        <div class="stat-label">×§×œ×•×¨×™×•×ª (××ª×•×š 1200)</div>
    </div>
    <div class="stat-card">
        <div id="weight-val" class="stat-val" style="color:var(--success);">--</div>
        <div class="stat-label">××©×§×œ ××—×¨×•×Ÿ</div>
    </div>
    <div class="stat-card">
        <div id="left-val" class="stat-val">1200</div>
        <div class="stat-label">× ×•×ª×¨ ×œ×”×™×•×</div>
    </div>
</div>

<div class="water-card">
    <div class="water-header">
        <span style="font-weight:700; font-size:1.1rem;">ğŸ’§ ×××–×Ÿ × ×•×–×œ×™×</span>
        <span id="water-count" style="font-family:monospace; font-size:1.1rem;">0 / 12</span>
    </div>
    <div class="progress-bg">
        <div id="water-bar" class="progress-fill"></div>
    </div>
    <div class="water-btns">
        <button class="water-btn" onclick="addWater(-1)">- ×”×¤×—×ª</button>
        <button class="water-btn" onclick="addWater(1)">+ ×›×•×¡ ××™×</button>
    </div>
</div>

<div class="cheat-meal-container">
    <div>
        <div style="font-weight:bold; color:var(--warning); font-size:1rem;">ğŸ” ×× ×” ××•×ª×¨×ª</div>
        <div style="font-size:0.8rem; color:var(--text-muted);">×¤×¢× ×‘×©×‘×•×¢ ×‘×œ×‘×“!</div>
        <div id="cheat-warning" style="font-size:0.75rem; color:var(--danger); display:none; margin-top:4px; font-weight:bold;">âš ï¸ × ×•×¦×œ×” ×›×‘×¨ ×”×©×‘×•×¢</div>
    </div>
    <label class="cheat-switch">
        <input type="checkbox" id="cheat-toggle" onchange="toggleCheat()">
        <span class="slider"></span>
    </label>
</div>

<div id="app"></div>

<div style="height:40px;"></div>

<div class="nav-bar">
    <button class="nav-btn" onclick="changeDate(-1)">
        <span class="nav-icon">â—€</span>
        <span>××ª××•×œ</span>
    </button>
    <button class="nav-btn active" onclick="scrollToTop()">
        <span class="nav-icon">ğŸ“…</span>
        <span>×”×™×•×</span>
    </button>
    <button class="nav-btn" onclick="openTools()">
        <span class="nav-icon">âš¡</span>
        <span>×›×œ×™×</span>
    </button>
    <button class="nav-btn" onclick="changeDate(1)">
        <span class="nav-icon">â–¶</span>
        <span>××—×¨</span>
    </button>
</div>

<div id="modal" onclick="if(event.target===this)closeModal()">
    <div class="modal-content">
        <h2 id="modal-title" style="margin-top:0; border-bottom:1px solid var(--border); padding-bottom:15px; color:var(--accent);"></h2>
        <div id="modal-body"></div>
        <button onclick="closeModal()" class="btn-close">×¡×’×•×¨ ×—×œ×•× ×™×ª</button>
    </div>
</div>

<script>
// --- ×××’×¨ × ×ª×•× ×™× ××œ× (×—×•×œ×¥ ×‘-100% ××”×§×•×‘×¥) ---
const DB = {
    carbs: [
        "1 ×¤×™×ª×” ×§×œ×” (×¢×“ 80 ×§×œ')", "1 ×¤×¨×•×¡×ª ×œ×—× ×¨×’×™×œ", "2 ×¤×¨×•×¡×•×ª ×œ×—× ×§×œ", "1/3 ×¤×™×ª×” ×¨×’×™×œ×”", 
        "1 ×œ×—×× ×™×™×” ×§×œ×”", "30 ×’×¨× ×œ×—×× ×™×™×”", "1/2 ××¦×”", "1 ××¦×” ×§×œ×”", "3 ×¤×ª×™×ª", "3 ×§×¨×§×¨×™× ×“×’× ×™×ª", 
        "2 ×¤×™×¨×›×™×•×ª ×©×™×‘×•×œ×ª ×©×•×¢×¨/××•×¨×–", "2 ×œ×—××™×ª/×§×¨×§×¨ ×–×”×‘", "10 ×¤×™×¨×›×™×•×ª ×‘×™×¡", "6 ×˜×•×¡×˜×¢×™×", 
        "1/2 ×˜×•×¨×˜×™×” ×’×“×•×œ×”", "1 ×¢×œ×” ×¡×™×’×¨", "5 ×“×¤×™ ××•×¨×–", "1 ×›×£ ×©×§×“×™ ××¨×§", "2 ×›×¤×•×ª ×§××— ×©×˜×•×—×•×ª", 
        "2 ×›×¤×•×ª ×¡×•×œ×ª", "2 ×›×¤×•×ª ×¤×™×¨×•×¨×™ ×œ×—×", "×—×¦×™ ×“×œ×•×¨×™×ª ×§×˜× ×”", "1/2 ×›×•×¡ ××¤×•× ×” ×™×¨×•×§×”", 
        "1 ×¡×œ×§ ×‘×™× ×•× ×™", "1 ×›×•×¡ × ×‘×˜×•×˜×™×", "1.5 ×›×•×¡ ×ª×¨××™×œ×™ ××“×××”", "100 ×’×¨× ××¨×˜×™×©×•×§ ×™×¨×•×©×œ××™",
        "--- ××ª×•×§×™× (××—×“ ×‘×™×•×) ---",
        "2 ×¤×ª×™ ×‘×¨", "2 ×¢×•×’×™×•×ª ×œ×œ× ×¡×•×›×¨", "1 ×—×˜×™×£ ×× ×¨×’×™×” (×¢×“ 100 ×§×œ')", "3/4 ×›×•×¡ ×§×•×¨× ×¤×œ×§×¡ ×œ×œ× ×¡×•×›×¨", 
        "2 ×›×¤×•×ª ×’×¨× ×•×œ×” ×œ×œ× ×¡×•×›×¨",
        "--- ××‘×•×©×œ×™× (1/2 ×›×•×¡ ××—×¨×™ ×‘×™×©×•×œ) ---",
        "××•×¨×–", "×‘×•×¨×’×•×œ", "×›×•×¡××ª", "×§×•×¡×§×•×¡", "×¤×ª×™×ª×™×", "×¤×¡×˜×”", "×§×™× ×•××”", "×ª×™×¨×¡", 
        "×§×˜× ×™×•×ª (×—×•××•×¡, ×¢×“×©×™×, ×¤×•×œ)", "1 ×ª×¤×•×— ××“××” ×‘×™× ×•× ×™", "1/2 ×‘×˜×˜×” ×§×˜× ×”", "1 ×§×œ×— ×ª×™×¨×¡ ×§×˜×Ÿ", 
        "3/4 ×›×•×¡ ×ª×™×¨×¡ ×§×œ", "5 ××§×œ×•×ª ×¦'×™×¤×¡ ×¨×’×™×œ", "3 ×¢×œ×™ ×’×¤×Ÿ", "7 ×¢×¨××•× ×™×", "1/2 ×›×•×¡ ×¤×™×¨×”",
        "--- ×—×˜×™×¤×™× (×¢×“ 3 ×‘×©×‘×•×¢) ---",
        "1 ×©×§×™×ª ×‘××‘×” ×§×˜× ×” (15 ×’×¨×)", "×©×§×™×ª ×¤×•×¤×§×•×¨×Ÿ (100 ×§×œ')", "2 ×›×•×¡×•×ª ×¤×•×¤×§×•×¨×Ÿ ×‘×™×ª×™", 
        "10 ×™×—' ×‘×™×™×’×œ×” ×§×˜×Ÿ", "1 ×©×§×™×ª ×¦'×™×¤×¡ ×§×™×“×¡"
    ],
    cheese: [
        "--- ×’×‘×™× ×•×ª ---",
        "2 ×›×¤×•×ª ×’×‘×™× ×” 3%-5%", "2 ××©×•×œ×©×™ ××•×Ÿ ×‘×œ××Ÿ", "60 ×’×¨× ×‘×•×œ×’×¨×™×ª/×¦×¤×ª×™×ª 5%", "2 ×›×¤×•×ª ×××¨×— ×˜×•×¤×•", 
        "1 ××¦×‘×¢ ××•×¦×¨×œ×”", "1 ×¤×¨×•×¡×ª ×¦×”×•×‘×” 9%", "2 ×¤×¨×•×¡×•×ª ×¦×”×•×‘×” 9% ×“×§-×“×§", "1 ×¤×¨×•×¡×ª ×¦×”×•×‘×” 22% (××—×ª ×‘×™×•×)",
        "--- ××¢×“× ×™× ×•× ×•×–×œ×™× ---",
        "1 ×’×‘×™×¢ ××¢×“×Ÿ/×™×•×’×•×¨×˜ 0%", "1 ×™×•×’×•×¨×˜ ×˜×‘×¢×™ 1.5%", "××©×§×” ×‘×•×§×¨ 0%", "×›×•×¡ ×©×•×§×• 0%", 
        "××§×˜×™××œ 3%", "3/4 ×›×•×¡ ×¨×•×•×™×•×Ÿ", "×›×•×¡ ×’×œ×™×“×” ×“×™××˜ 2%-5%", "1 ×©×œ×’×•×Ÿ ×—×œ×‘×™ (×¢×“ 80 ×§×œ')", 
        "1 ×›×•×¡ ×—×œ×‘ 1%", "1 ×›×•×¡ ×—×œ×‘ ×¡×•×™×” ×˜×‘×¢×™",
        "--- ×—×œ×‘×•×Ÿ ×‘×©×¨×™/×¦××—×™ ---",
        "1 ×‘×™×¦×”", "×—×¦×™ ×§×•×¤×¡× ×˜×•× ×” ×‘××™×", "1.5 ×›×£ ×˜×•× ×” ×‘×©××Ÿ", "50 ×’×¨× ×××¨×— ×˜×•× ×”", "3 ×›×“×•×¨×™ ×¤×œ××¤×œ ××¤×•×™×™×", 
        "80 ×’×¨× ×“×’ ××‘×•×©×œ", "60 ×’×¨× ×˜×•×¤×•", "1/2 ×›×•×¡ ×¤×•×œ×™ ×¡×•×™×”", "1/2 ×§×•×¤×¡×ª ×¡×¨×“×™× ×™×",
        "--- ×ª×—×œ×™×¤×™× (×¤×¢××™×™× ×‘×©×‘×•×¢) ---",
        "1/2 ×›×•×¡ ×—×œ×‘ 3%", "100 ×\"×œ ×©×× ×ª ××œ×¤×¨×• 5%", "1 ×›×•×¡ ×—×œ×‘ ×©×§×“×™×", "1 ××¢×“×Ÿ ×¡×•×™×” ××œ×¤×¨×•"
    ],
    meat: [
        "--- ×‘×©×¨ ×•×¢×•×£ (150 ×’' ×œ×¤× ×™ ×‘×™×©×•×œ) ---",
        "×—×–×” ×¢×•×£", "×‘×§×¨ ×¨×–×” (×¢×’×œ/×¤×™×œ×”)", "1/4 ×¢×•×£ (×‘×œ×™ ×¢×•×¨)", "3 ×©×•×§×™ ×¢×•×£", "×©×•×•××¨××” ×”×•×“×• (150 ×’×¨×)", 
        "3 ×§×¦×™×¦×•×ª ×‘×§×¨", "2 ×©×™×¤×•×“×™ ×¢×•×£/×¤×¨×’×™×ª", "3 ×›×“×•×¨×™ ×‘×©×¨ ×¨×–×”",
        "--- ×“×’×™× (200 ×’' ×œ×¤× ×™ ×‘×™×©×•×œ) ---",
        "×“×’ ××¤×•×™/××‘×•×©×œ (××× ×•×Ÿ, ×“× ×™×¡, ×¡×œ××•×Ÿ, ×˜×•× ×”)", "1.5 ×§×•×¤×¡××•×ª ×˜×•× ×” ×‘××™×", "1 ×§×•×¤×¡×ª ×˜×•× ×” ×‘×©××Ÿ ××¡×•× × ×ª", 
        "1 ×§×•×¤×¡×ª ×¡×¨×“×™× ×™× ××¡×•× × ×™×",
        "--- ×¦××—×™/××—×¨ ---",
        "6 ×›×“×•×¨×™ ×¤×œ××¤×œ ××¤×•×™×™×", "1.5 ×›×•×¡×•×ª ×§×˜× ×™×•×ª ××‘×•×©×œ×•×ª", "3 ×›×¤×•×ª ×—×•××•×¡", "150 ×’×¨× ×˜×•×¤×•",
        "--- ××•×’×‘×œ×™× (×¤×¢××™×™× ×‘×©×‘×•×¢) ---",
        "200 ×’×¨× ×¤×¡×˜×¨××” ×œ×™×™×˜", "2 ×©× ×™×¦×œ ×˜×‘×¢×•×œ (×¢×“ 99 ×§×œ')", "1 ×”××‘×•×¨×’×¨ ×‘×ª× ×•×¨ (×¤×¢× ×‘×©×‘×•×¢)", 
        "3 × ×§× ×™×§×™×•×ª (×¤×¢× ×‘×©×‘×•×¢)", "3 ×›×‘×“×™ ×¢×•×£"
    ],
    fat: [
        "1 ×›×¤×™×ª ×©××Ÿ", "6 ×–×™×ª×™× ×§×˜× ×™×", "2 ×–×™×ª×™× ×’×“×•×œ×™×", "1 ×›×£ ×˜×—×™× ×” ××•×›× ×”", "1 ×›×¤×™×ª ×˜×—×™× ×” ×’×•×œ××™×ª", 
        "1 ×›×£ ××‘×•×§×“×•", "1 ×›×¤×™×ª ×—×•××•×¡", "1 ×›×£ ×–×¨×¢×™ ×¤×©×ª×Ÿ/×¦'×™×”", "1 ×›×£ ×§×•×§×•×¡", "2 ×›×¤×•×ª ×©×× ×ª ×—××•×¦×” 15%", 
        "1 ×›×¤×™×ª ×—×××”", "5 ×›×¤×•×ª ×©×× ×ª ××œ×¤×¨×• 5%", "7 ×©×§×“×™×", "3 ××’×•×–×™ ××œ×š/×¤×§××Ÿ", "10 ×‘×•×˜× ×™×/×¤×™×¡×˜×•×§×™×", 
        "1 ×›×¤×™×ª ××™×•× ×–", "1 ×›×£ ×›××•×™×•× ×–", "1 ×›×£ ×××¨×— ×©×•××©×•×", "10 ×’×¨× ×—×œ×•×•×”", "3 ×›×¤×•×ª ×¨×•×˜×‘ ×œ×™×™×˜"
    ],
    fruit: [
        "×ª×¤×•×— ×¢×¥", "××’×¡", "×‘× × ×” ×§×˜× ×”", "1 ×›×•×¡ ××‘×˜×™×—/××œ×•×Ÿ", "2 ×©×–×™×¤×™×", "1 ××¤×¨×¡×§", "1 × ×§×˜×¨×™× ×”", 
        "1 ××¤×¨×¡××•×Ÿ ×§×˜×Ÿ", "1/2 ××©×›×•×œ×™×ª", "1/2 ×× ×’×•", "1 ×›×•×¡ ×¢× ×‘×™×/×“×•×‘×“×‘× ×™×", "2 ×ª××¨×™× ×™×‘×©×™×", 
        "1 ×ª××¨ ××’'×”×•×œ", "2 ×§×™×•×•×™", "2 ×§×œ×× ×˜×™× ×•×ª", "3 ××©××©×™×", "1 ×—×‘×•×©", "1/3 ×¤×•××œ×”", "1 ×›×•×¡ ×ª×•×ª×™×"
    ],
    half_cheese: [
        "×¤×¨×•×¡×ª ×’×‘×™× ×” ×¦×”×•×‘×” 5%", "×›×£ ×’×‘×™× ×” 5%", "×—×¦×™ ×¤×¨×•×¡×” ×¦×”×•×‘×” 9%", "30 ×’×¨× ×‘×•×œ×’×¨×™×ª", 
        "×›×¤×™×ª ×—×•××•×¡", "×—×¦×™ ×›×•×¡ ×—×œ×‘ 1%", "1/4 ×§×•×¤×¡×ª ×˜×•× ×” ×‘××™×", "×—×¦×™ ×‘×™×¦×”", "2 ×¤×¨×•×¡×•×ª ×¤×¡×˜×¨××”", "1.5 ×¤×œ××¤×œ ××¤×•×™"
    ]
};

// ×”×’×“×¨×•×ª ××¨×•×—×•×ª (×©×¢×•×ª ×•×§×œ×•×¨×™×•×ª)
const mealsConfig = [
    { n: "××¨×•×—×ª ×‘×•×§×¨", t: 9, c: 200, p: [{l: "×¤×—××™××”", d: DB.carbs}, {l: "×—×œ×‘×•×Ÿ ×’×‘×™× ×”", d: DB.cheese}] },
    { n: "×‘×™× ×™×™× ×‘×•×§×¨", t: 11, c: 150, p: [{l: "×¤×¨×™", d: DB.fruit}, {l: "×©×•××Ÿ", d: DB.fat}] },
    { n: "××¨×•×—×ª ×¦×”×¨×™×™×", t: 13, c: 350, p: [{l: "×—×œ×‘×•×Ÿ ×‘×©×¨", d: DB.meat}, {l: "×¤×—××™××”", d: DB.carbs}, {l: "×©×•××Ÿ", d: DB.fat}] },
    { n: "×‘×™× ×™×™× ××—×”×´×¦", t: 16, c: 150, p: [{l: "×¤×—××™××”", d: DB.carbs}, {l: "×¤×¨×™", d: DB.fruit}, {l: "×©×•××Ÿ", d: DB.fat}] },
    { n: "××¨×•×—×ª ×¢×¨×‘", t: 19, c: 250, p: [{l: "×¤×—××™××”", d: DB.carbs}, {l: "×—×œ×‘×•×Ÿ ×’×‘×™× ×”", d: DB.cheese}, {l: "×—×¦×™ ×—×œ×‘×•×Ÿ", d: DB.half_cheese}, {l: "×©×•××Ÿ", d: DB.fat}] },
    { n: "××¨×•×—×ª ×œ×™×œ×”", t: 22, c: 100, p: [{l: "×—×œ×‘×•×Ÿ ×’×‘×™× ×”", d: DB.cheese}, {l: "×¤×¨×™", d: DB.fruit}] }
];

// × ×™×”×•×œ ××¦×‘ ×”××¤×œ×™×§×¦×™×” (State)
let vDate = new Date();
let appData = JSON.parse(localStorage.getItem('heli_pro_v3')) || { days: {}, weights: [] };

// ×¤×•× ×§×¦×™×•×ª ×¢×–×¨
const getK = d => d.toLocaleDateString('he-IL').replace(/\./g, '-');
const save = () => localStorage.setItem('heli_pro_v3', JSON.stringify(appData));
const scrollToTop = () => { vDate = new Date(); init(); window.scrollTo({top:0, behavior:'smooth'}); };

// ××ª×—×•×œ ×”××¤×œ×™×§×¦×™×”
function init() {
    const k = getK(vDate);
    const day = appData.days[k] || {};
    const todayK = getK(new Date());
    
    // ×¢×“×›×•×Ÿ ×›×•×ª×¨×ª ×•×ª××¨×™×š
    document.getElementById('cur-date-display').innerText = (k === todayK) ? "×”×™×•×, " + k : k;
    document.getElementById('cur-date-display').style.color = (k === todayK) ? 'var(--accent)' : 'var(--text)';
    
    // ×—×™×©×•×‘ ×¨×¦×£
    calculateStreak();

    // ×‘× ×™×™×ª ×”××¨×•×—×•×ª (Render)
    const currentHour = new Date().getHours();
    let html = '';
    
    mealsConfig.forEach((m, i) => {
        // ×‘×“×™×§×ª ×”×©×œ××”
        let isComplete = true;
        m.p.forEach((_, pi) => { if (!day[`${i}_${pi}`]) isComplete = false; });
        
        // ×‘×“×™×§×ª ×–××Ÿ × ×•×›×—×™ (×œ×”×“×’×©×”)
        const isNow = (k === todayK && currentHour >= m.t - 1 && currentHour < m.t + 2);
        
        html += `
        <div class="meal-card ${isComplete ? 'completed' : ''} ${isNow ? 'active-now' : ''}">
            <div class="meal-header">
                <div class="meal-title-wrap">
                    <span class="meal-time">${String(m.t).padStart(2, '0')}:00</span>
                    <span class="meal-title">${m.n}</span>
                    ${isComplete ? '<span style="color:var(--success);">âœ“</span>' : ''}
                </div>
                <span class="meal-cal">${m.c} ×§×œ'</span>
            </div>
            ${m.p.map((part, pi) => `
                <div>
                    <label>${part.l}</label>
                    <select onchange="updateMeal('${k}', '${i}_${pi}', this.value)">
                        <option value="">×‘×—×¨...</option>
                        ${part.d.map(x => {
                            const isHeader = x.startsWith('---');
                            return `<option value="${isHeader?'':x}" ${isHeader?'disabled style="color:var(--accent); font-weight:bold; background:#1e293b;"':''} ${day[`${i}_${pi}`]===x ? 'selected' : ''}>${x.replace(/---/g,'').trim()}</option>`;
                        }).join('')}
                    </select>
                </div>
            `).join('')}
        </div>`;
    });
    
    document.getElementById('app').innerHTML = html;
    
    // ×¢×“×›×•×Ÿ ××™×
    const water = day.water || 0;
    document.getElementById('water-count').innerText = `${water} / 12`;
    document.getElementById('water-bar').style.width = `${Math.min((water/12)*100, 100)}%`;
    if(water >= 12) document.getElementById('water-bar').style.background = '#10b981';
    else document.getElementById('water-bar').style.background = '#60a5fa';

    // ×¢×“×›×•×Ÿ ×× ×” ××•×ª×¨×ª
    const isCheat = day.isCheatMeal || false;
    document.getElementById('cheat-toggle').checked = isCheat;
    checkCheatHistory(k);

    updateStats(day);
}

// ×¢×“×›×•×Ÿ ×‘×—×™×¨×ª ××–×•×Ÿ
function updateMeal(k, id, val) {
    if (!appData.days[k]) appData.days[k] = {};
    appData.days[k][id] = val;
    save();
    init(); // ×¨×¢× ×•×Ÿ ×œ×ª×¦×•×’×” ×•×™×–×•××œ×™×ª (V ×™×¨×•×§)
}

// ×”×•×¡×¤×ª ××™×
function addWater(amount) {
    const k = getK(vDate);
    if (!appData.days[k]) appData.days[k] = {};
    const cur = appData.days[k].water || 0;
    const newVal = Math.max(0, cur + amount);
    appData.days[k].water = newVal;
    
    // ×§×•× ×¤×˜×™ ×‘×¡×™×•× ×™×¢×“
    if (newVal === 12 && amount > 0 && typeof confetti === 'function') {
        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
    }
    
    save();
    init();
}

// ×˜×•×’×œ ×× ×” ××•×ª×¨×ª
function toggleCheat() {
    const k = getK(vDate);
    if (!appData.days[k]) appData.days[k] = {};
    appData.days[k].isCheatMeal = document.getElementById('cheat-toggle').checked;
    save();
    init();
}

// ×‘×“×™×§×” ×× × ×œ×§×—×” ×× ×” ××•×ª×¨×ª ×”×©×‘×•×¢
function checkCheatHistory(currentK) {
    let found = false;
    let d = new Date(vDate);
    // ×‘×“×™×§×” 6 ×™××™× ××—×•×¨×”
    for(let i=1; i<=6; i++) {
        d.setDate(d.getDate() - 1);
        let k = getK(d);
        if (appData.days[k] && appData.days[k].isCheatMeal) found = true;
    }
    const warn = document.getElementById('cheat-warning');
    if (found) { warn.style.display = 'block'; }
    else { warn.style.display = 'none'; }
}

// ×¢×“×›×•×Ÿ ×¡×˜×˜×™×¡×˜×™×§×” ×¢×œ×™×•× ×”
function updateStats(day) {
    let t = 0;
    mealsConfig.forEach((m, i) => {
        let active = false;
        m.p.forEach((_, pi) => { if(day[`${i}_${pi}`]) active = true; });
        if(active) t += m.c;
    });
    
    const calEl = document.getElementById('cal-val');
    calEl.innerText = t;
    document.getElementById('left-val').innerText = Math.max(0, 1200 - t);
    
    if (t > 1200) calEl.style.color = '#ef4444';
    else calEl.style.color = '#3b82f6';

    const lastW = appData.weights.length ? appData.weights[appData.weights.length-1].w : '--';
    document.getElementById('weight-val').innerText = lastW;
}

// ×—×™×©×•×‘ ×™××™ ×¨×¦×£
function calculateStreak() {
    let streak = 0;
    let d = new Date();
    // ×œ×•×œ××” ××—×•×¨×” ×‘×–××Ÿ
    while(true) {
        let k = getK(d);
        let day = appData.days[k];
        // ×”× ×—×”: ×™×•× × ×—×©×‘ "×¤×¢×™×œ" ×× ×¡×•×× ×• ×œ×¤×—×•×ª 3 ×¤×¨×™×˜×™×
        if (day && Object.keys(day).filter(key => key.includes('_')).length >= 3) {
            streak++;
            d.setDate(d.getDate() - 1);
        } else {
            // ×× ×”×™×•× ×”× ×•×›×—×™ ×¢×“×™×™×Ÿ ×¨×™×§, ×œ× ×©×•×‘×¨×™× ×¨×¦×£, ×¨×§ ××“×œ×’×™× ×‘×‘×“×™×§×”
            if (k === getK(new Date()) && streak === 0) {
                 d.setDate(d.getDate() - 1);
                 continue;
            }
            break;
        }
    }
    document.getElementById('streak-count').innerText = streak;
}

function changeDate(n) {
    vDate.setDate(vDate.getDate() + n);
    init();
}

// --- ×›×œ×™× ×•××•×“××œ×™× ---

function openTools() {
    document.getElementById('modal-title').innerText = "××¨×’×– ×›×œ×™×";
    document.getElementById('modal-body').innerHTML = `
        <div class="tools-grid">
            <button class="tool-btn" onclick="copyYesterday()">
                <span style="font-size:1.8rem">ğŸ“‹</span>
                <span>×”×¢×ª×§ ×××ª××•×œ</span>
            </button>
            <button class="tool-btn" onclick="shareDay()">
                <span style="font-size:1.8rem">ğŸ’¬</span>
                <span>×©×ª×£ ×‘×•×•××˜×¡××¤</span>
            </button>
            <button class="tool-btn" onclick="generateShopList()">
                <span style="font-size:1.8rem">ğŸ›’</span>
                <span>×¨×©×™××ª ×§× ×™×•×ª</span>
            </button>
            <button class="tool-btn" onclick="openWeightModal()">
                <span style="font-size:1.8rem">âš–ï¸</span>
                <span>××¢×§×‘ ××©×§×œ</span>
            </button>
            <button class="tool-btn" onclick="exportData()">
                <span style="font-size:1.8rem">ğŸ’¾</span>
                <span>×’×™×‘×•×™ × ×ª×•× ×™×</span>
            </button>
             <button class="tool-btn" onclick="importData()">
                <span style="font-size:1.8rem">ğŸ“‚</span>
                <span>×©×—×–×•×¨ ××’×™×‘×•×™</span>
            </button>
        </div>
        <div style="margin-top:25px; border-top:1px solid #334155; pt-3;">
            <h4 style="color:var(--accent); margin-bottom:10px;">×“×’×©×™× ×—×©×•×‘×™×:</h4>
            <ul style="font-size:0.85rem; color:#cbd5e1; padding-right:20px; line-height:1.6;">
                <li>×œ× ×œ×“×œ×’ ×¢×œ ××¨×•×—×•×ª.</li>
                <li>××¨×•×•×— ×©×œ 1.5-3 ×©×¢×•×ª ×‘×™×Ÿ ××¨×•×—×•×ª.</li>
                <li>12 ×›×•×¡×•×ª ××™× ×—×•×‘×” ×‘×™×•×.</li>
                <li>×™×¨×§×•×ª ×—×•×¤×©×™ - ×‘×©×¤×™×•×ª.</li>
            </ul>
        </div>
    `;
    document.getElementById('modal').style.display = 'flex';
}

function closeModal() { document.getElementById('modal').style.display = 'none'; }

// ×›×œ×™: ×”×¢×ª×§×” ×××ª××•×œ
function copyYesterday() {
    const todayK = getK(vDate);
    const yDate = new Date(vDate);
    yDate.setDate(yDate.getDate() - 1);
    const yK = getK(yDate);
    
    if (appData.days[yK] && Object.keys(appData.days[yK]).length > 0) {
        if(!confirm('×”×× ×œ×“×¨×•×¡ ××ª ×”× ×ª×•× ×™× ×©×œ ×”×™×•× ×•×œ×”×¢×ª×™×§ ×××ª××•×œ?')) return;
        
        const copy = {...appData.days[yK]};
        delete copy.isCheatMeal; // ×œ× ××¢×ª×™×§×™× ×× ×” ××•×ª×¨×ª
        delete copy.water;       // ×œ× ××¢×ª×™×§×™× ××™×
        
        appData.days[todayK] = { ...appData.days[todayK], ...copy };
        save();
        init();
        closeModal();
    } else {
        alert('×œ× × ××¦××• × ×ª×•× ×™× ×××ª××•×œ ×œ×”×¢×ª×§×”.');
    }
}

// ×›×œ×™: ×©×™×ª×•×£
function shareDay() {
    const k = getK(vDate);
    const day = appData.days[k] || {};
    let text = `*×™×•××Ÿ ××›×™×œ×” - ${k}*\n`;
    let totalC = 0;
    
    mealsConfig.forEach((m, i) => {
        let mealTxt = ``;
        let hasItems = false;
        m.p.forEach((_, pi) => {
            const val = day[`${i}_${pi}`];
            if (val) {
                mealTxt += `â€¢ ${val}\n`;
                hasItems = true;
            }
        });
        if(hasItems) {
            text += `\n*${m.n}:*\n${mealTxt}`;
            totalC += m.c;
        }
    });
    
    text += `\nğŸ’§ ××™×: ${day.water || 0} ×›×•×¡×•×ª`;
    if(day.isCheatMeal) text += `\nğŸ” *×‘×•×¦×¢×” ×× ×” ××•×ª×¨×ª*`;
    text += `\n×¡×”"×› ×§×œ×•×¨×™×•×ª: ${totalC}`;
    
    window.open(`https://wa.me/?text=${encodeURIComponent(text)}`);
}

// ×›×œ×™: ×¨×©×™××ª ×§× ×™×•×ª
function generateShopList() {
    const k = getK(vDate);
    const day = appData.days[k];
    if(!day || Object.keys(day).length < 2) return alert('×”×™×•× ×¨×™×§, ××œ× ××•×ª×• ×›×“×™ ×œ×™×¦×•×¨ ×¨×©×™××”.');
    
    let items = [];
    Object.keys(day).forEach(key => {
        if(key !== 'water' && key !== 'isCheatMeal') items.push(day[key]);
    });
    
    let text = `*×¨×©×™××ª ×§× ×™×•×ª ×œ-${k}:*\n` + items.map(i => `- [ ] ${i}`).join('\n');
    window.open(`https://wa.me/?text=${encodeURIComponent(text)}`);
}

// ×›×œ×™: ×’×¨×£ ××©×§×œ
function openWeightModal() {
    closeModal();
    document.getElementById('modal-title').innerText = "××¢×§×‘ ××©×§×œ";
    
    // ×—×™×©×•×‘ ××’××” (×××•×¦×¢ × ×¢)
    const weights = appData.weights;
    const labels = weights.map(w => w.d);
    const rawData = weights.map(w => w.w);
    
    // ×××•×¦×¢ × ×¢ ×©×œ 3 ××“×™×“×•×ª ××—×¨×•× ×•×ª ×œ×”×—×œ×§×ª ×”×’×¨×£
    const trendData = rawData.map((val, idx, arr) => {
        if (idx < 2) return val;
        return ((arr[idx] + arr[idx-1] + arr[idx-2]) / 3).toFixed(1);
    });

    document.getElementById('modal-body').innerHTML = `
        <div class="chart-container">
            <canvas id="wChartPro"></canvas>
        </div>
        <div style="display:flex; gap:10px; margin-top:20px;">
            <input type="number" id="new-weight" placeholder="×”×›× ×¡ ××©×§×œ (×§×´×’)..." step="0.1" style="margin:0;">
            <button class="btn-primary" onclick="addWeight()" style="width:auto; padding:0 20px;">×©××•×¨</button>
        </div>
        <h4 style="margin-bottom:5px; margin-top:15px; color:var(--text-muted);">×”×™×¡×˜×•×¨×™×”:</h4>
        <ul style="font-size:0.9rem; color:#cbd5e1; max-height:120px; overflow-y:auto; padding-right:20px; list-style:none;">
            ${weights.slice().reverse().map(w => `<li style="border-bottom:1px solid #334155; padding:8px 0; display:flex; justify-content:space-between;"><span>${w.d}</span> <strong>${w.w} ×§"×’</strong></li>`).join('')}
        </ul>
    `;
    document.getElementById('modal').style.display = 'flex';

    // ×”×©×”×™×™×” ×§×œ×” ×œ×˜×¢×™× ×ª ×”×’×¨×£ ×›×“×™ ×œ×•×•×“× ×©×§× ×‘×¡ × ×˜×¢×Ÿ
    setTimeout(() => {
        const ctx = document.getElementById('wChartPro').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels.slice(-10), 
                datasets: [
                    { label: '××©×§×œ', data: rawData.slice(-10), borderColor: '#3b82f6', tension: 0.3, pointRadius: 4, borderWidth: 2 },
                    { label: '××’××”', data: trendData.slice(-10), borderColor: '#f59e0b', borderDash: [5,5], pointRadius:0, borderWidth: 1 }
                ]
            },
            options: { 
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: true, labels: { color: '#94a3b8' } } },
                scales: { 
                    y: { grid: { color: '#334155' }, ticks: { color: '#94a3b8' } }, 
                    x: { display:false } 
                } 
            }
        });
    }, 150);
}

function addWeight() {
    const val = parseFloat(document.getElementById('new-weight').value);
    if(val) {
        appData.weights.push({d: getK(new Date()), w: val});
        save();
        init();
        openWeightModal();
    }
}

// ×›×œ×™: ×’×™×‘×•×™ ×•×©×—×–×•×¨
function exportData() {
    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(appData));
    const a = document.createElement('a');
    a.href = dataStr;
    a.download = "heli_backup_" + getK(new Date()) + ".json";
    document.body.appendChild(a);
    a.click();
    a.remove();
}

function importData() {
    const input = document.createElement('input');
    input.type = 'file';
    input.onchange = e => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.readAsText(file,'UTF-8');
        reader.onload = readerEvent => {
            try {
                const content = JSON.parse(readerEvent.target.result);
                if(content.days && content.weights) {
                    appData = content;
                    save();
                    init();
                    alert('×”× ×ª×•× ×™× ×©×•×—×–×¨×• ×‘×”×¦×œ×—×”!');
                    closeModal();
                } else { alert('×§×•×‘×¥ ×œ× ×ª×§×™×Ÿ'); }
            } catch(e) { alert('×©×’×™××” ×‘×§×¨×™××ª ×”×§×•×‘×¥'); }
        }
    }
    input.click();
}

init();
</script>
</body>
</html>

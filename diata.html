<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Heli 1200 Dark - Fixed & Restored</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { 
            --bg: #121212; 
            --card: #1e1e1e; 
            --text: #e0e0e0; 
            --accent: #4dabf7; 
            --success: #00e676; 
            --danger: #ff5252;
            --border: #333;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; padding-bottom: 90px; }
        
        /* Stats Bar */
        .stats-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 15px; position: sticky; top: 5px; z-index: 900; }
        .stat-box { background: rgba(30, 30, 30, 0.95); padding: 8px; border-radius: 12px; text-align: center; border: 1px solid var(--border); backdrop-filter: blur(5px); box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .stat-label { font-size: 0.7rem; color: #aaa; margin-bottom: 2px; }
        .stat-val { font-size: 1.2rem; font-weight: bold; }
        
        /* General Styles */
        h3 { color: var(--accent); margin: 0 0 10px 0; font-size: 1.1rem; border-bottom: 1px solid #333; padding-bottom: 8px; }
        .card { background: var(--card); border-radius: 16px; padding: 15px; margin-bottom: 15px; border: 1px solid var(--border); }
        
        /* Forms */
        label { font-size: 0.8rem; color: #888; display: block; margin-bottom: 4px; }
        select, input { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--border); background: #2c2c2c; color: #fff; font-size: 0.95rem; margin-bottom: 12px; appearance: none; }
        select:focus, input:focus { border-color: var(--accent); outline: none; }
        
        /* Archive Table */
        .archive-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; margin-top: 10px; }
        .archive-table th { text-align: right; color: #777; padding: 5px; border-bottom: 1px solid #444; }
        .archive-table td { padding: 8px 5px; border-bottom: 1px solid #333; }
        .del-btn { background: none; border: none; font-size: 1rem; cursor: pointer; padding: 5px; }
        
        /* Nav */
        .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #1a1a1a; padding: 12px; display: flex; gap: 10px; border-top: 1px solid #333; z-index: 1000; box-shadow: 0 -5px 20px rgba(0,0,0,0.7); }
        .nav-btn { flex: 1; background: #333; color: var(--text); padding: 12px; border-radius: 8px; border: none; font-weight: bold; font-size: 0.9rem; }
        
        /* Modal */
        #modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:2000; justify-content:center; align-items:center; }
        .modal-content { background: var(--card); width: 90%; max-height: 85%; border-radius: 15px; padding: 20px; overflow-y: auto; border: 1px solid var(--border); }
    </style>
</head>
<body>

<div class="stats-row">
    <div class="stat-box">
        <div class="stat-label">×§×œ×•×¨×™×•×ª</div>
        <div id="cal-count" class="stat-val" style="color: var(--accent);">0</div>
    </div>
    <div class="stat-box">
        <div class="stat-label">××©×§×œ × ×•×›×—×™</div>
        <div id="last-weight" class="stat-val" style="color: #fff;">--</div>
    </div>
    <div class="stat-box" style="border-color: var(--success);">
        <div class="stat-label">×™×¨×“×ª×™ ×¡×”×´×›</div>
        <div id="total-lost" class="stat-val" style="color: var(--success);">0</div>
    </div>
</div>

<div id="app"></div>

<div class="card">
    <h3>ğŸ“‰ ××¨×›×™×•×Ÿ ××©×§×œ</h3>
    <div style="display:flex; gap:10px; margin-bottom:15px;">
        <input type="number" id="w-in" step="0.1" placeholder="×”×–×Ÿ ××©×§×œ..." style="flex:1; margin:0;">
        <button onclick="addW()" style="background:var(--success); color:#000; border:none; border-radius:8px; padding:0 20px; font-weight:bold;">×©××•×¨</button>
    </div>
    <canvas id="wChart" style="max-height:180px; width:100%; margin-bottom:10px;"></canvas>
    <div style="max-height:200px; overflow-y:auto;">
        <table class="archive-table">
            <thead><tr><th>×ª××¨×™×š</th><th>××©×§×œ</th><th>×©×™× ×•×™</th><th></th></tr></thead>
            <tbody id="w-history-body"></tbody>
        </table>
    </div>
</div>

<div class="nav-bar">
    <button class="nav-btn" onclick="changeDate(-1)">â—„ ×™×•× ×§×•×“×</button>
    <button class="nav-btn" onclick="openReport()">ğŸ“„ ×¡×™×›×•×</button>
    <button class="nav-btn" onclick="changeDate(1)">×™×•× ×”×‘× â–º</button>
</div>

<div id="modal">
    <div class="modal-content">
        <h2 id="modal-title" style="text-align:center; color:var(--accent);"></h2>
        <div id="modal-body" style="line-height:1.6; color:#ccc;"></div>
        <button onclick="document.getElementById('modal').style.display='none'" style="width:100%; margin-top:20px; background:var(--danger); color:white; padding:12px; border:none; border-radius:8px;">×¡×’×•×¨</button>
    </div>
</div>

<script>
// --- FULL 100% DATABASE ---
const DB = {
    carbs: [
        "1 ×¤×™×ª×” ×§×œ×” (×¢×“ 80 ×§×œ×•×¨×™×•×ª ×œ×™×—×™×“×”)", "1 ×¤×¨×•×¡×ª ×œ×—× ×¨×’×™×œ", "2 ×¤×¨×•×¡×•×ª ×œ×—× ×§×œ", "1/3 ×¤×™×ª×” ×¨×’×™×œ×”", 
        "1 ×œ×—×× ×™×™×” ×§×œ×” (×¢×“ 80 ×§×œ×•×¨×™×•×ª)", "30 ×’×¨× ×œ×—×× ×™×™×” ××›×œ ×¡×•×’", "1/2 ××¦×”", "1 ××¦×” ×§×œ×”", "3 ×¤×ª×™×ª", 
        "3 ×§×¨×§×¨×™× ×“×’× ×™×ª ×‘×™×™×’×œ ×‘×™×™×’×œ", "2 ×¤×™×¨×›×™×•×ª ×©×™×‘×•×œ×ª ×©×•×¢×¨/××•×¨×–", "2 ×œ×—××™×ª/×§×¨×§×¨ ×–×”×‘", "10 ×¤×™×¨×›×™×•×ª ×‘×™×¡", 
        "6 ×˜×•×¡×˜×¢×™× ××œ×‘× ×™×™×", "1/2 ×˜×•×¨×˜×™×” ×’×“×•×œ×”", "1 ×¢×œ×” ×¡×™×’×¨ ×’×“×•×œ ××• 2 ×§×˜× ×™×", "5 ×“×¤×™ ××•×¨×–", "1 ×›×£ ×©×§×“×™ ××¨×§", 
        "2 ×›×¤×•×ª ×§××— ×©×˜×•×—×•×ª", "2 ×›×¤×•×ª ×¡×•×œ×ª ×©×˜×•×—×•×ª", "2 ×›×¤×•×ª ×¤×™×¨×•×¨×™ ×œ×—× ×œ× ××˜×•×’× ×™×", "×—×¦×™ ×“×œ×•×¨×™×ª ×§×˜× ×”", 
        "1/2 ×›×•×¡ ××¤×•× ×” ×™×¨×•×§×”", "1 ×¡×œ×§ ×‘×™× ×•× ×™", "1 ×›×•×¡ × ×‘×˜×•×˜×™×", "1.5 ×›×•×¡ ×ª×¨××™×œ×™ ××“×××”", 
        "1/3 ×“×œ×¢×ª ×¢×¨××•× ×™× / ×“×œ×¢×ª ×¡×¤×’×˜×™", "8 ×ª×—×ª×™×•×ª ××¨×˜×™×©×•×§", "100 ×’×¨× ××¨×˜×™×©×•×§ ×™×¨×•×©×œ××™", 
        "--- ××ª×•×§×™× (××—×“ ×‘×™×•×) ---", "2 ×¤×ª×™ ×‘×¨", "2 ×¢×•×’×™×•×ª ×œ×œ× ×¡×•×›×¨", "1 ×—×˜×™×£ ×× ×¨×’×™×” (×¢×“ 100 ×§×œ')", 
        "3/4 ×›×•×¡ ×§×•×¨× ×¤×œ×§×¡ ×œ×œ× ×¡×•×›×¨", "2 ×›×¤×•×ª ×’×¨× ×•×œ×” ×œ×œ× ×¡×•×›×¨", 
        "--- ×¤×—××™××•×ª ××‘×•×©×œ×•×ª (1/2 ×›×•×¡ ××—×¨×™ ×‘×™×©×•×œ) ---", "××•×¨×–", "×‘×•×¨×’×•×œ", "×›×•×¡××ª", "×§×•×¡×§×•×¡", "×¤×ª×™×ª×™×", "×¤×¡×˜×”", 
        "×§×™× ×•××”", "×ª×™×¨×¡", "×§×˜× ×™×•×ª (×—×•××•×¡, ×©×¢×•×¢×™×ª, ×¢×“×©×™×, ×¤×•×œ)", "1 ×ª×¤×•×— ××“××” ×‘×™× ×•× ×™", "1/2 ×‘×˜×˜×” ×§×˜× ×”", 
        "1 ×§×œ×— ×ª×™×¨×¡ ×§×˜×Ÿ", "3/4 ×›×•×¡ ×ª×™×¨×¡ ×§×œ", "5 ××§×œ×•×ª ×¦'×™×¤×¡ ×¨×’×™×œ", "3 ×™×—×™×“×•×ª ×¢×œ×™ ×’×¤×Ÿ", "7 ×¢×¨××•× ×™×", "1/2 ×›×•×¡ ×¤×™×¨×”",
        "--- ×—×˜×™×¤×™× (×¢×“ 3 ×¤×¢××™× ×‘×©×‘×•×¢) ---", "1 ×©×§×™×ª ×‘××‘×” ×§×˜× ×” (15 ×’×¨×)", "×©×§×™×ª ×¤×•×¤×§×•×¨×Ÿ (×¢×“ 100 ×§×œ')", 
        "2 ×›×•×¡×•×ª ×¤×•×¤×§×•×¨×Ÿ ×‘×™×ª×™ ×œ×œ× ×©××Ÿ", "1 ×›×•×¡ ×¤×•×¤×§×•×¨×Ÿ ×¢× ×©××Ÿ", "10 ×™×—' ×‘×™×™×’×œ×” ×§×˜×Ÿ", "1 ×©×§×™×ª ×¦'×™×¤×¡ ×§×™×“×¡"
    ],
    cheese: [
        "2 ×›×¤×•×ª ×’×‘×™× ×” 3%-5% (×§×•×˜×’', ×œ×‘× ×”, ×¡×™××¤×•× ×™×”)", "2 ××©×•×œ×©×™ ××•×Ÿ ×‘×œ××Ÿ", "60 ×’×¨× ×’×‘×™× ×” ×§×©×” ×¢×“ 5% (×¦×¤×ª×™×ª/×‘×•×œ×’×¨×™×ª)", 
        "2 ×›×¤×•×ª ×××¨×— ×˜×•×¤×• (×¢×“ 5%)", "1 ××¦×‘×¢ ××•×¦×¨×œ×”", "1 ×¤×¨×•×¡×ª ×¦×”×•×‘×” 9%", "2 ×¤×¨×•×¡×•×ª ×¦×”×•×‘×” 9% ×“×§-×“×§", 
        "1 ×¤×¨×•×¡×ª ×¦×”×•×‘×” 22% (×¤×¢× ×‘×™×•×)", "1 ×’×‘×™×¢ ××¢×“×Ÿ/×™×•×’×•×¨×˜ 0% (×¢×“ 80 ×§×œ')", "1 ×’×‘×™×¢ ×™×•×’×•×¨×˜ ×˜×‘×¢×™ 1.5%", 
        "××©×§×” ×‘×•×§×¨ 0%", "×›×•×¡ ×©×•×§×• 0%", "×™×—×™×“×ª ××§×˜×™××œ 3%", "3/4 ×›×•×¡ ×¨×•×•×™×•×Ÿ", "×›×•×¡ ×’×œ×™×“×” ×“×™××˜ 2%-5%", 
        "1 ×©×œ×’×•×Ÿ ×—×œ×‘×™ ×¢×“ 80 ×§×œ'", "1 ×›×•×¡ ×—×œ×‘ 1%", "1 ×›×•×¡ ×—×œ×‘ ×¡×•×™×” ×œ×œ× ×¡×•×›×¨", "1/2 ×›×•×¡ ×¤×•×œ×™ ×¡×•×™×”", "60 ×’×¨× ×˜×•×¤×•", 
        "1 ×‘×™×¦×”", "×—×¦×™ ×§×•×¤×¡× ×˜×•× ×” ×‘××™×", "1.5 ×›×£ ×˜×•× ×” ×‘×©××Ÿ", "50 ×’×¨× ×××¨×— ×˜×•× ×”/×¡×œ××•×Ÿ", "3 ×›×“×•×¨×™ ×¤×œ××¤×œ ××¤×•×™×™×", 
        "80 ×’×¨× ×“×’ ××‘×•×©×œ", "1/2 ×›×•×¡ ×—×œ×‘ 3% (×¤×¢××™×™× ×‘×©×‘×•×¢)", "100 ×\"×œ ×©×× ×ª ××œ×¤×¨×• 5%", "1 ×›×•×¡ ×—×œ×‘ ×©×§×“×™× ×œ×œ× ×¡×•×›×¨"
    ],
    meat: [
        "--- ×‘×©×¨ (150×’' ×œ×¤× ×™ / 100×’' ××—×¨×™) ---", "×—×–×” ×¢×•×£", "×‘×§×¨ ×œ×œ× ×©×•××Ÿ (×¢×’×œ/×¤×™×œ×”)", "1/4 ×¢×•×£ (×œ×œ× ×¢×•×¨)", 
        "3 ×©×•×§×™ ×¢×•×£ (×¤×•×œ×§×¢)", "×©×•×•××¨××” ×”×•×“×• (150 ×’×¨×)", "3 ×§×¦×™×¦×•×ª ×‘×§×¨", "2 ×©×™×¤×•×“×™ ×¢×•×£/×¤×¨×’×™×ª", "3 ×›×“×•×¨×™ ×‘×©×¨ ×¨×–×”",
        "--- ×“×’×™× (200×’' ×œ×¤× ×™ / 150×’' ××—×¨×™) ---", "×“×’ ××¤×•×™/××‘×•×©×œ (××× ×•×Ÿ, ×“× ×™×¡, ×¡×œ××•×Ÿ, ×˜×•× ×”)", 
        "1.5 ×§×•×¤×¡××•×ª ×˜×•× ×” ×‘××™×", "1 ×§×•×¤×¡×ª ×˜×•× ×” ×‘×©××Ÿ ××¡×•× × ×ª", "1 ×§×•×¤×¡×ª ×¡×¨×“×™× ×™× ××¡×•× × ×™×",
        "--- ×ª×—×œ×™×¤×™× ---", "6 ×›×“×•×¨×™ ×¤×œ××¤×œ ××¤×•×™×™×", "1.5 ×›×•×¡×•×ª ×§×˜× ×™×•×ª ××‘×•×©×œ×•×ª", "3 ×›×¤×•×ª ×—×•××•×¡", "150 ×’×¨× ×˜×•×¤×•",
        "2 ×©× ×™×¦×œ ×˜×‘×¢×•×œ (×¢×“ ×¤×¢××™×™× ×‘×©×‘×•×¢)", "1 ×”××‘×•×¨×’×¨ ×‘×ª× ×•×¨ (×¤×¢× ×‘×©×‘×•×¢)", "3 × ×§× ×™×§×™×•×ª (×¤×¢× ×‘×©×‘×•×¢)"
    ],
    fat: [
        "1 ×›×¤×™×ª ×©××Ÿ ××›×œ ×¡×•×’", "6 ×–×™×ª×™× ×§×˜× ×™×", "2 ×–×™×ª×™× ×’×“×•×œ×™×", "1 ×›×£ ×˜×—×™× ×” ××•×›× ×”", "1 ×›×¤×™×ª ×˜×—×™× ×” ×’×•×œ××™×ª", 
        "1 ×›×£ ××‘×•×§×“×•", "1 ×›×¤×™×ª ×—×•××•×¡", "1 ×›×£ ×–×¨×¢×™ ×¤×©×ª×Ÿ/×¦'×™×”", "1 ×›×£ ×§×•×§×•×¡ ×˜×—×•×Ÿ", "2 ×›×¤×•×ª ×©×× ×ª ×—××•×¦×” 15%", 
        "1 ×›×¤×™×ª ×—×××”", "5 ×›×¤×•×ª ×©×× ×ª ××œ×¤×¨×• 5%", "7 ×©×§×“×™×", "3 ××’×•×–×™ ××œ×š/×¤×§××Ÿ", "10 ×‘×•×˜× ×™×/×¤×™×¡×˜×•×§×™×", 
        "1 ×›×¤×™×ª ××™×•× ×–", "1 ×›×£ ×›××•×™×•× ×–", "1 ×›×£ ×××¨×— ×©×•××©×•×", "10 ×’×¨× ×—×œ×•×•×”"
    ],
    fruit: [
        "×ª×¤×•×— ×¢×¥", "××’×¡ ×‘×™× ×•× ×™", "×‘× × ×” ×§×˜× ×”", "1 ×›×•×¡ ×§×•×‘×™×•×ª ××‘×˜×™×—/××œ×•×Ÿ", "2 ×©×–×™×¤×™×", "1 ××¤×¨×¡×§", "1 × ×§×˜×¨×™× ×”", 
        "1 ××¤×¨×¡××•×Ÿ ×§×˜×Ÿ", "1/2 ××©×›×•×œ×™×ª", "1/2 ×× ×’×•", "1 ×›×•×¡ ×¢× ×‘×™×/×“×•×‘×“×‘× ×™×", "2 ×ª××¨×™× ×™×‘×©×™×", "1 ×ª××¨ ××’'×”×•×œ", 
        "2 ×§×™×•×•×™", "2 ×§×œ×× ×˜×™× ×•×ª", "3 ××©××©×™×", "1 ×—×‘×•×© ×§×˜×Ÿ", "1/3 ×¤×•××œ×”"
    ],
    half_cheese: [
        "×¤×¨×•×¡×ª ×’×‘×™× ×” ×¦×”×•×‘×” 5%", "×›×£ ×’×‘×™× ×” 5%", "×—×¦×™ ×¤×¨×•×¡×” ×¦×”×•×‘×” 9%", "30 ×’×¨× ×‘×•×œ×’×¨×™×ª", "×›×¤×™×ª ×—×•××•×¡", 
        "×—×¦×™ ×›×•×¡ ×—×œ×‘ 1%", "1/4 ×§×•×¤×¡×ª ×˜×•× ×” ×‘××™×", "×—×¦×™ ×‘×™×¦×”", "2 ×¤×¨×•×¡×•×ª ×¤×¡×˜×¨××”"
    ]
};

const mealsConfig = [
    { n: "××¨×•×—×ª ×‘×•×§×¨", c: 200, p: [{l: "×¤×—××™××”", d: DB.carbs}, {l: "×—×œ×‘×•×Ÿ ×’×‘×™× ×”", d: DB.cheese}] },
    { n: "×‘×™× ×™×™× ×‘×•×§×¨", c: 150, p: [{l: "×¤×¨×™", d: DB.fruit}, {l: "×©×•××Ÿ", d: DB.fat}] },
    { n: "××¨×•×—×ª ×¦×”×¨×™×™×", c: 350, p: [{l: "×—×œ×‘×•×Ÿ ×‘×©×¨", d: DB.meat}, {l: "×¤×—××™××”", d: DB.carbs}, {l: "×©×•××Ÿ", d: DB.fat}] },
    { n: "×‘×™× ×™×™× ××—×”×´×¦", c: 150, p: [{l: "×¤×—××™××”", d: DB.carbs}, {l: "×¤×¨×™", d: DB.fruit}, {l: "×©×•××Ÿ", d: DB.fat}] },
    { n: "××¨×•×—×ª ×¢×¨×‘", c: 250, p: [{l: "×¤×—××™××”", d: DB.carbs}, {l: "×—×œ×‘×•×Ÿ ×’×‘×™× ×”", d: DB.cheese}, {l: "×—×¦×™ ×—×œ×‘×•×Ÿ", d: DB.half_cheese}, {l: "×©×•××Ÿ", d: DB.fat}] },
    { n: "××¨×•×—×ª ×œ×™×œ×”", c: 100, p: [{l: "×—×œ×‘×•×Ÿ ×’×‘×™× ×”", d: DB.cheese}, {l: "×¤×¨×™", d: DB.fruit}] }
];

let vDate = new Date();
// RESTORE KEY: heli_dark_archive
let data = JSON.parse(localStorage.getItem('heli_dark_archive')) || { days:{}, weights:[] };

function getK(d){ return d.toLocaleDateString('he-IL').replace(/\./g,'-'); }

function init() {
    const k = getK(vDate);
    document.getElementById('app').innerHTML = mealsConfig.map((m, i) => `
        <div class="card">
            <h3>${m.n} <span style="font-size:0.8rem; color:#888; float:left;">${m.c} ×§×œ'</span></h3>
            ${m.p.map((part, pi) => `
                <div style="margin-bottom:10px;">
                    <label>${part.l}</label>
                    <select onchange="updM('${k}', '${i}_${pi}', this.value)">
                        <option value="">×‘×—×¨...</option>
                        ${part.d.map(x => {
                            const isH = x.startsWith('---');
                            return `<option value="${isH?'':x}" ${isH?'disabled style="color:var(--accent); font-weight:bold;"':''} ${(data.days[k] && data.days[k][i+'_'+pi]===x)?'selected':''}>${x}</option>`;
                        }).join('')}
                    </select>
                </div>
            `).join('')}
        </div>
    `).join('');
    updateStats();
    renderW();
}

function updM(k, id, v){ 
    if(!data.days[k]) data.days[k]={}; 
    data.days[k][id]=v; 
    save(); 
    updateStats(); 
}

function addW(){ 
    const v = document.getElementById('w-in').value; if(!v)return;
    data.weights.push({id: Date.now(), d:getK(new Date()), w:parseFloat(v)});
    save(); document.getElementById('w-in').value=''; renderW();
}

function delW(id){
    if(confirm("×œ××—×•×§ ×©×§×™×œ×”?")){
        data.weights = data.weights.filter(w => w.id !== id);
        save(); renderW();
    }
}

function updateStats(){
    const k = getK(vDate);
    const day = data.days[k] || {};
    let t = 0;
    mealsConfig.forEach((m, i) => {
        let active = false;
        m.p.forEach((_, pi) => { if(day[i+'_'+pi]) active = true; });
        if(active) t += m.c;
    });
    document.getElementById('cal-count').innerText = t;
}

function renderW(){
    const sorted = [...data.weights].sort((a,b) => a.id - b.id);
    
    // Total Lost
    if(sorted.length > 0) {
        const cur = sorted[sorted.length-1].w;
        const first = sorted[0].w;
        document.getElementById('last-weight').innerText = cur;
        const diff = (first - cur).toFixed(1);
        const el = document.getElementById('total-lost');
        el.innerText = diff > 0 ? "-"+diff : (diff<0 ? "+"+Math.abs(diff) : "0");
        el.style.color = diff >= 0 ? "var(--success)" : "var(--danger)";
    }

    // Chart
    const ctx = document.getElementById('wChart').getContext('2d');
    if(window.myChart) window.myChart.destroy();
    window.myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: sorted.slice(-10).map(x=>x.d),
            datasets: [{ label:'××©×§×œ', data:sorted.slice(-10).map(x=>x.w), borderColor:'#4dabf7', backgroundColor:'rgba(77,171,247,0.1)', fill:true, tension:0.4 }]
        },
        options: { plugins: { legend: {display:false} }, scales: { x: {display:false}, y: {grid:{color:'#333'}} } }
    });

    // Archive Table
    let html = '';
    [...sorted].reverse().forEach((e, i, arr) => {
        let diffHtml = '-';
        if(i < arr.length-1) {
            let prev = arr[i+1].w;
            let ch = (e.w - prev).toFixed(1);
            if(ch < 0) diffHtml = `<span style="color:var(--success)">â–¼${Math.abs(ch)}</span>`;
            else if(ch > 0) diffHtml = `<span style="color:var(--danger)">â–²${ch}</span>`;
            else diffHtml = `<span style="color:#777">0</span>`;
        }
        html += `<tr><td>${e.d}</td><td style="color:white; font-weight:bold;">${e.w}</td><td>${diffHtml}</td><td><button class="del-btn" onclick="delW(${e.id})">ğŸ—‘ï¸</button></td></tr>`;
    });
    document.getElementById('w-history-body').innerHTML = html || '<tr><td colspan="4" style="text-align:center; padding:10px; color:#666">××™×Ÿ × ×ª×•× ×™×</td></tr>';
}

function save(){ localStorage.setItem('heli_dark_archive', JSON.stringify(data)); }
function changeDate(n){ vDate.setDate(vDate.getDate()+n); init(); }

function openReport() {
    const k = getK(vDate);
    const day = data.days[k] || {};
    let html = '';
    mealsConfig.forEach((m, i) => {
        html += `<div style="margin-bottom:10px; border-bottom:1px solid #333; padding-bottom:5px;"><strong style="color:var(--accent)">${m.n}</strong><br>`;
        m.p.forEach((p, pi) => { if(day[i+'_'+pi]) html += `<span style="font-size:0.9rem; color:#ccc;">â€¢ ${p.l}: ${day[i+'_'+pi]}</span><br>`; });
        html += `</div>`;
    });
    document.getElementById('modal-title').innerText = "×¡×™×›×•×: " + k;
    document.getElementById('modal-body').innerHTML = html || "×œ× × ×¨×©××• ××¨×•×—×•×ª";
    document.getElementById('modal').style.display = 'flex';
}

init();
</script>
</body>
</html>

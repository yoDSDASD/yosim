<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Heli 1200 Ultimate - Yosef</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --p: #1e40af; --bg: #f8fafc; --txt: #1e293b; --success: #10b981; --err: #ef4444; --accent: #f59e0b; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--txt); margin: 0; padding: 12px; padding-bottom: 60px; }
        .motivation-bar { background: linear-gradient(135deg, var(--p), #3b82f6); color: white; padding: 15px; border-radius: 12px; text-align: center; font-weight: bold; margin-bottom: 15px; font-size: 1rem; box-shadow: 0 4px 10px rgba(30, 64, 175, 0.2); }
        .card { background: white; border-radius: 16px; padding: 15px; margin-bottom: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid #e2e8f0; }
        .stats-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; position: sticky; top: 10px; z-index: 100; }
        .stat-box { background: white; padding: 10px; border-radius: 14px; text-align: center; border: 1px solid #cbd5e1; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .btn-nav { display: flex; gap: 5px; margin-bottom: 15px; }
        button { flex: 1; padding: 12px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-primary { background: var(--p); color: white; }
        .btn-secondary { background: #cbd5e1; color: #1e293b; }
        .meal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #f1f5f9; padding-bottom: 8px; margin-bottom: 12px; }
        .meal-title { font-size: 1.1rem; font-weight: 800; color: var(--p); }
        .meal-cal { font-size: 0.85rem; color: #64748b; background: #f1f5f9; padding: 2px 8px; border-radius: 6px; }
        .select-group { margin-bottom: 15px; }
        label { font-size: 0.8rem; color: #475569; font-weight: 700; display: block; margin-bottom: 6px; }
        select { width: 100%; padding: 14px; border-radius: 10px; border: 1px solid #cbd5e1; font-size: 0.95rem; background: #fff; color: var(--txt); appearance: none; }
        .note { font-size: 0.75rem; color: #ef4444; margin-top: 4px; font-style: italic; background: #fef2f2; padding: 5px; border-radius: 6px; }
        .weight-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #f1f5f9; }
        /* Modal */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: white; width: 90%; max-height: 85vh; border-radius: 20px; padding: 20px; overflow-y: auto; position: relative; }
    </style>
</head>
<body>

<div id="quote" class="motivation-bar">×˜×•×¢×Ÿ ××©×¤×˜ ×”×©×¨××”...</div>

<div class="stats-row">
    <div class="stat-box">
        <div id="cur-date" style="font-size: 0.75rem; color: #64748b;">×”×™×•×</div>
        <div id="cal-count" style="font-size: 1.5rem; font-weight: 800; color: var(--p);">0</div>
        <div style="font-size: 0.65rem;">×§×œ×•×¨×™×•×ª ×©× ×‘×—×¨×•</div>
    </div>
    <div class="stat-box">
        <div style="font-size: 0.75rem; color: #64748b;">××©×§×œ × ×•×›×—×™</div>
        <div id="last-weight" style="font-size: 1.5rem; font-weight: 800; color: var(--success);">--</div>
        <div style="font-size: 0.65rem;">×§×´×’</div>
    </div>
</div>

<div class="btn-nav">
    <button onclick="changeDate(-1)" class="btn-secondary">â—„ ×™×•× ×§×•×“×</button>
    <button onclick="openReport()" class="btn-secondary" style="flex:1.5;">ğŸ“‹ ×“×•×— ×•×™×•××Ÿ</button>
    <button onclick="changeDate(1)" class="btn-secondary">×”×‘× â–º</button>
</div>

<div id="meals-list"></div>

<div class="card">
    <h3 style="margin:0 0 15px 0; color:var(--p);">××¢×§×‘ ××©×§×œ</h3>
    <div style="display:flex; gap:10px; margin-bottom:15px;">
        <input type="number" id="w-in" step="0.1" placeholder="×”×›× ×¡ ××©×§×œ (×§×´×’)" style="flex:1; padding:12px; border-radius:10px; border:1px solid #ddd; font-size:1rem;">
        <button onclick="addW()" class="btn-primary" style="flex:0.4;">×¢×“×›×Ÿ</button>
    </div>
    <canvas id="wChart" style="max-height:180px;"></canvas>
    <div id="w-history" style="margin-top:15px; max-height:150px; overflow-y:auto; font-size:0.9rem;"></div>
</div>

<div id="modal" class="modal-overlay">
    <div class="modal-content">
        <h3 id="modal-date" style="margin-top:0; color:var(--p); border-bottom:2px solid #eee; padding-bottom:10px;"></h3>
        <div id="modal-body"></div>
        <button onclick="document.getElementById('modal').style.display='none'" style="width:100%; background:var(--err); color:white; padding:12px; border-radius:10px; margin-top:15px; font-weight:bold; border:none;">×¡×’×•×¨</button>
    </div>
</div>

<script>
// --- × ×ª×•× ×™× ×©× ×©××‘×• ×™×©×™×¨×•×ª ××§×•×‘×¥ ×”-HTML ---
const DB = {
    carbs: [
        "--- ×œ×—× ×•×××¤×™× ---",
        "1 ×¤×™×ª×” ×§×œ×” (×¢×“ 80 ×§×œ×•×¨×™×•×ª)", "2 ×¤×¨×•×¡×•×ª ×œ×—× ×§×œ", "1 ×¤×¨×•×¡×ª ×œ×—× ×¨×’×™×œ", "1/3 ×¤×™×ª×” ×¨×’×™×œ×”", "1 ×œ×—×× ×™×™×” ×§×œ×” (×¢×“ 80 ×§×œ')", "30 ×’×¨× ×œ×—×× ×™×™×” ××›×œ ×¡×•×’", "1/2 ××¦×”", "1 ××¦×” ×§×œ×”", "3 ×¤×ª×™×ª", "3 ×§×¨×§×¨×™× ×“×’× ×™×ª/×‘×™×™×’×œ", "2 ×¤×™×¨×›×™×•×ª ××•×¨×–/×©×™×‘×•×œ×ª ×©×•×¢×œ", "2 ×œ×—××™×ª/×§×¨×§×¨ ×–×”×‘", "10 ×¤×™×¨×›×™×•×ª ×‘×™×¡", "6 ×˜×•×¡×˜×¢×™× ××œ×‘× ×™×™×", "1/2 ×˜×•×¨×˜×™×” ×’×“×•×œ×”", "1 ×¢×œ×” ×¡×™×’×¨ ×’×“×•×œ / 2 ×§×˜× ×™×", "5 ×“×¤×™ ××•×¨×–", "1 ×›×£ ×©×§×“×™ ××¨×§", "2 ×›×¤×•×ª ×§××—/×¡×•×œ×ª/×¤×™×¨×•×¨×™ ×œ×—×",
        "--- ×¤×—××™××•×ª ××‘×•×©×œ×•×ª ---",
        "1/2 ×›×•×¡ ××•×¨×– (×œ××—×¨ ×‘×™×©×•×œ)", "1/2 ×›×•×¡ ×¤×¡×˜×”/×¤×ª×™×ª×™× (×œ××—×¨ ×‘×™×©×•×œ)", "1/2 ×›×•×¡ ×‘×•×¨×’×•×œ/×›×•×¡××ª/×§×•×¡×§×•×¡ (××‘×•×©×œ)", "1/2 ×›×•×¡ ×§×˜× ×™×•×ª (×—×•××•×¡, ×¢×“×©×™×, ×©×¢×•×¢×™×ª)", "1 ×ª×¤×•×— ××“××” ×‘×™× ×•× ×™", "1/2 ×‘×˜×˜×” ××ª×•×§×” ×§×˜× ×”", "1 ×§×œ×— ×ª×™×¨×¡ ×§×˜×Ÿ", "3/4 ×›×•×¡ ×ª×™×¨×¡ ×§×œ (×©×™××•×¨×™×)", "1/2 ×›×•×¡ ××¤×•× ×” ×™×¨×•×§×”", "5 ××§×œ×•×ª ×¦'×™×¤×¡ ×¨×’×™×œ", "3 ×™×—×™×“×•×ª ×¢×œ×™ ×’×¤×Ÿ", "7 ×¢×¨××•× ×™×", "1/2 ×›×•×¡ ×¤×™×¨×”",
        "--- ×—×˜×™×¤×™× ×•××ª×•×§×™× (××•×’×‘×œ) ---",
        "1 ×©×§×™×ª ×‘××‘×” ×§×˜× ×” (15 ×’×¨×)", "×©×§×™×ª ×¤×•×¤×§×•×¨×Ÿ (×¢×“ 100 ×§×œ')", "2 ×›×•×¡×•×ª ×¤×•×¤×§×•×¨×Ÿ ×‘×™×ª×™ (×œ×œ× ×©××Ÿ)", "1 ×›×•×¡ ×¤×•×¤×§×•×¨×Ÿ ×‘×™×ª×™ (×¢× ×©××Ÿ)", "10 ×™×—' ×‘×™×™×’×œ×” ×§×˜×Ÿ", "1 ×©×§×™×ª ×¦'×™×¤×¡ ×§×™×“×¡", "2 ×¤×ª×™ ×‘×¨", "2 ×¢×•×’×™×•×ª ×œ×œ× ×¡×•×›×¨", "1 ×—×˜×™×£ ×× ×¨×’×™×” (×¢×“ 100 ×§×œ')", "3/4 ×›×•×¡ ×§×•×¨× ×¤×œ×§×¡ ×œ×œ× ×¡×•×›×¨", "2 ×›×¤×•×ª ×’×¨× ×•×œ×” ×œ×œ× ×¡×•×›×¨"
    ],
    protein_cheese: [
        "--- ×’×‘×™× ×•×ª ---",
        "2 ×›×¤×•×ª ×’×‘×™× ×” 5% (×§×•×˜×’', ×œ×‘× ×”, ×¡×™××¤×•× ×™×”)", "60 ×’×¨× ×’×‘×™× ×” ×§×©×” 5% (×¦×¤×ª×™×ª/×‘×•×œ×’×¨×™×ª)", "1 ×¤×¨×•×¡×ª ×’×‘×™× ×” ×¦×”×•×‘×” 9%", "2 ×¤×¨×•×¡×•×ª ×’×‘×™× ×” ×¦×”×•×‘×” 9% ×“×§-×“×§", "1 ×¤×¨×•×¡×ª ×’×‘×™× ×” ×¦×”×•×‘×” 22% (×¤×¢× ×‘×™×•×)", "2 ××©×•×œ×©×™ ××•×Ÿ ×‘×œ××Ÿ", "1 ××¦×‘×¢ ××•×¦×¨×œ×”", "2 ×›×¤×•×ª ×××¨×— ×˜×•×¤×• 5%",
        "--- ××¢×“× ×™× ×•××©×§××•×ª ---",
        "1 ×’×‘×™×¢ ××¢×“×Ÿ/×™×•×’×•×¨×˜ 0% (×¢×“ 80 ×§×œ')", "1 ×’×‘×™×¢ ×™×•×’×•×¨×˜ ×˜×‘×¢×™ 1.5%", "×‘×§×‘×•×§ ××©×§×” ×‘×•×§×¨ 0%", "1 ×›×•×¡ ×—×œ×‘ 1%", "1 ×›×•×¡ ×—×œ×‘ ×¡×•×™×” (×œ×œ× ×¡×•×›×¨)", "×›×•×¡ ×©×•×§×• 0%", "1 ××§×˜×™××œ 3%",
        "--- ×ª×—×œ×™×¤×™× (×‘×™×¦×”/×“×’/×˜×•×¤×•) ---",
        "1 ×‘×™×¦×”", "1/2 ×§×•×¤×¡×” ×˜×•× ×” ×‘××™×", "1.5 ×›×£ ×˜×•× ×” ×‘×©××Ÿ", "50 ×’×¨× ×¡×œ××•×Ÿ ××¢×•×©×Ÿ", "3 ×›×“×•×¨×™ ×¤×œ××¤×œ ××¤×•×™×™×", "80 ×’×¨× ×“×’ ××‘×•×©×œ", "60 ×’×¨× ×˜×•×¤×•", "1/2 ×›×•×¡ ×¤×•×œ×™ ×¡×•×™×”"
    ],
    protein_meat: [
        "--- ×¢×•×£ ×•×‘×©×¨ (150×’' ×œ×¤× ×™ / 100×’' ××—×¨×™) ---",
        "×—×–×” ×¢×•×£ (×¦×œ×•×™/××‘×•×©×œ)", "×‘×§×¨ ×œ×œ× ×©×•××Ÿ (×¢×’×œ/×¤×™×œ×”/×¡×™× ×˜×”)", "1/4 ×¢×•×£ (×œ×œ× ×¢×•×¨)", "3 ×©×•×§×™ ×¢×•×£ (×¤×•×œ×§×¢)", "×©×•×•××¨××” ×”×•×“×• (150 ×’×¨×)", "3 ×§×¦×™×¦×•×ª ×‘×§×¨", "2 ×©×™×¤×•×“×™ ×¢×•×£/×¤×¨×’×™×ª", "3 ×›×“×•×¨×™ ×‘×©×¨ (×¢×•×£/×”×•×“×•)", "2 ×¤×¨×•×¡×•×ª ×¤×¡×˜×¨××” ×“×œ×ª ×©×•××Ÿ",
        "--- ×“×’×™× (200×’' ×œ×¤× ×™ / 150×’' ××—×¨×™) ---",
        "×“×’ ××¤×•×™ (××× ×•×Ÿ, ×“× ×™×¡, ×¡×œ××•×Ÿ, ×œ×‘×¨×§)", "1.5 ×§×•×¤×¡××•×ª ×˜×•× ×” ×‘××™× (200 ×’×¨×)", "1 ×§×•×¤×¡×ª ×˜×•× ×” ×‘×©××Ÿ (××¡×•× × ×ª ×”×™×˜×‘)", "1 ×§×•×¤×¡×ª ×¡×¨×“×™× ×™× (××¡×•× × ×ª)", 
        "--- ×ª×—×œ×™×¤×™× ×¦××—×™×™×/××¢×•×‘×“×™× ---",
        "2 ×©× ×™×¦×œ ×ª×™×¨×¡ ×œ×™×™×˜ (×˜×‘×¢×•×œ)", "2 ×”××‘×•×¨×’×¨/×§×‘×‘ ××Ÿ ×”×¦×•××— (×¢×“ 99 ×§×œ')", "1.5 ×›×•×¡×•×ª ×§×˜× ×™×•×ª ××‘×•×©×œ×•×ª (×¢×“×©×™×/×©×¢×•×¢×™×ª)", "3 ×›×¤×•×ª ×—×•××•×¡ ×’×¨×’×¨×™×/×××¨×—"
    ],
    fruit: [
        "×ª×¤×•×— ×¢×¥ ×‘×™× ×•× ×™", "××’×¡ ×‘×™× ×•× ×™", "×‘× × ×” ×§×˜× ×”", "1 ×›×•×¡ ×§×•×‘×™×•×ª ××‘×˜×™×—", "1 ×›×•×¡ ×§×•×‘×™×•×ª ××œ×•×Ÿ", "1 ××¤×¨×¡×§ / × ×§×˜×¨×™× ×”", "2 ×©×–×™×¤×™×", "3 ××©××©×™×", "1/2 ×× ×’×•", "1 ×›×•×¡ ×¢× ×‘×™×", "1 ×›×•×¡ ×“×•×‘×“×‘× ×™×", "2 ×ª××¨×™× ×™×‘×©×™×", "1 ×ª××¨ ××’'×”×•×œ", "1/2 ××©×›×•×œ×™×ª / ×¤×•××œ×™×ª", "2 ×§×œ×× ×˜×™× ×•×ª / ×§×™×•×•×™", "4 ×©×¡×§ / ×¤×¡×™×¤×œ×•×¨×”"
    ],
    fat: [
        "1 ×›×¤×™×ª ×©××Ÿ (×›×œ ×¡×•×’)", "1 ×›×£ ×˜×—×™× ×” ××•×›× ×”", "1 ×›×¤×™×ª ×˜×—×™× ×” ×’×•×œ××™×ª", "1 ×›×£ ××‘×•×§×“×• / ×—×•××•×¡", "6 ×–×™×ª×™× ×§×˜× ×™× / 2 ×’×“×•×œ×™×", "7 ×©×§×“×™×", "3 ××’×•×–×™ ××œ×š / ×¤×§×× ×™×", "10 ×‘×•×˜× ×™× / ×¤×™×¡×˜×•×§×™×", "1 ×›×£ ×’×¨×¢×™× ×™ ×—×× ×™×”/×“×œ×¢×ª", "1 ×›×¤×™×ª ××™×•× ×– / 1 ×›×£ ×›××•×™×•× ×–", "2 ×›×¤×•×ª ×©×× ×ª ×—××•×¦×” 9%-15%"
    ],
    half_protein: [
        "1 ×¤×¨×•×¡×ª ×’×‘×™× ×” ×¦×”×•×‘×” 5%", "1 ×›×£ ×’×‘×™× ×” 5% ×’×“×•×©×”", "×—×¦×™ ×‘×™×¦×” ×§×©×”", "1/4 ×§×•×¤×¡×” ×˜×•× ×” ×‘××™×", "30 ×’×¨× ×’×‘×™× ×” ×‘×•×œ×’×¨×™×ª/×¦×¤×ª×™×ª", "×—×¦×™ ×’×‘×™×¢ ×™×•×’×•×¨×˜", "30 ×’×¨× ×˜×•×¤×•"
    ]
};

// --- ×”×’×“×¨×ª ×”××¨×•×—×•×ª ×”××“×•×™×§×ª ×œ×¤×™ ×”-HTML ×•×”×ª××•× ×•×ª ---
const mealsConfig = [
    { 
        n: "××¨×•×—×ª ×‘×•×§×¨", 
        c: 200, 
        parts: [
            { label: "×× ×ª ×¤×—××™××”", list: DB.carbs },
            { label: "×× ×ª ×—×œ×‘×•×Ÿ (×’×‘×™× ×”)", list: DB.protein_cheese }
        ] 
    },
    { 
        n: "××¨×•×—×ª ×‘×™× ×™×™× (×‘×•×§×¨)", 
        c: 150, 
        parts: [
            { label: "×× ×ª ×¤×¨×™", list: DB.fruit },
            { label: "×× ×ª ×©×•××Ÿ (×œ×¤×™ ×¦×™×œ×•× ××¡×š)", list: DB.fat } // ×ª×•×§×Ÿ ×¢"×¤ ×¦×™×œ×•× ××¡×š image_33ba10
        ] 
    },
    { 
        n: "××¨×•×—×ª ×¦×”×¨×™×™×", 
        c: 350, 
        parts: [
            { label: "×—×œ×‘×•×Ÿ ×‘×©×¨/×“×’/×¦××—×™", list: DB.protein_meat, note: "* ×× ×ª ×‘×©×¨: 150 ×’×¨× ×œ×¤× ×™ ×‘×™×©×•×œ = 100 ×’×¨× ××—×¨×™." },
            { label: "×× ×ª ×¤×—××™××”", list: DB.carbs },
            { label: "×× ×ª ×©×•××Ÿ", list: DB.fat }
        ] 
    },
    { 
        n: "××¨×•×—×ª ×‘×™× ×™×™× (××—×”×´×¦)", 
        c: 150, 
        parts: [
            { label: "×× ×ª ×¤×—××™××”", list: DB.carbs },
            { label: "×× ×ª ×¤×¨×™", list: DB.fruit }
        ] 
    },
    { 
        n: "××¨×•×—×ª ×¢×¨×‘", 
        c: 250, 
        parts: [
            { label: "×× ×ª ×¤×—××™××”", list: DB.carbs },
            { label: "×× ×ª ×—×œ×‘×•×Ÿ (×’×‘×™× ×”)", list: DB.protein_cheese },
            { label: "×—×¦×™ ×× ×ª ×—×œ×‘×•×Ÿ × ×•×¡×¤×ª", list: DB.half_protein, note: "* ×‘××¨×•×—×ª ×¢×¨×‘ ××•×ª×¨ ×× ×” ×•×—×¦×™ ×—×œ×‘×•×Ÿ ×’×‘×™× ×”" },
            { label: "×× ×ª ×©×•××Ÿ", list: DB.fat }
        ] 
    },
    { 
        n: "××¨×•×—×ª ×œ×™×œ×”", 
        c: 100, 
        parts: [
            { label: "×× ×ª ×—×œ×‘×•×Ÿ (×’×‘×™× ×”)", list: DB.protein_cheese },
            { label: "×× ×ª ×¤×¨×™", list: DB.fruit }
        ] 
    }
];

const quotes = [
    "×™×•×¡×£, ×”×“×™×•×§ ×‘×¤×¨×˜×™× ×”×§×˜× ×™× ×”×•× ×”×¡×•×“ ×œ×”×¦×œ×—×”!",
    "×ª×¤×¨×™×˜ 1200 ×§×œ×•×¨×™×•×ª ×”×•× ×”××¡×’×¨×ª, ×›×•×— ×”×¨×¦×•×Ÿ ×”×•× ×”×× ×•×¢.",
    "×›×œ ××¨×•×—×” ××“×•×™×§×ª ×”×™× × ×™×¦×—×•×Ÿ ×¢×œ ×”×’×•×£ ×•×”× ×¤×©.",
    "××ª×” ×œ× ××•×•×ª×¨ ×¢×œ ×¢×¦××š, ××ª×” ××©×§×™×¢ ×‘×¢×¦××š.",
    "×”×”×ª××“×” ××©×ª×œ××ª. ×”×ª×•×¦××•×ª ×™×’×™×¢×•."
];

let currentDate = new Date();
let appData = JSON.parse(localStorage.getItem('heli_yosef_full_v1')) || { days: {}, weights: [] };

function getDateKey(date) {
    return date.toLocaleDateString('he-IL').replace(/\./g, '-');
}

function initApp() {
    document.getElementById('quote').innerText = quotes[Math.floor(Math.random() * quotes.length)];
    const dateKey = getDateKey(currentDate);
    const isToday = dateKey === getDateKey(new Date());
    
    document.getElementById('cur-date').innerText = isToday ? "×”×™×•×" : dateKey;
    document.getElementById('cur-date').style.fontWeight = isToday ? "bold" : "normal";
    
    const dayData = appData.days[dateKey] || {};
    const container = document.getElementById('meals-list');
    container.innerHTML = '';

    mealsConfig.forEach((meal, mIndex) => {
        let mealHTML = `
            <div class="card">
                <div class="meal-header">
                    <span class="meal-title">${meal.n}</span>
                    <span class="meal-cal">${meal.c} ×§×œ'</span>
                </div>`;
        
        meal.parts.forEach((part, pIndex) => {
            const selectId = `${mIndex}_${pIndex}`;
            const selectedValue = dayData[selectId] || "";
            
            mealHTML += `
                <div class="select-group">
                    <label>${part.label}</label>
                    <select onchange="saveSelection('${dateKey}', '${selectId}', this.value)">
                        <option value="">×‘×—×¨ ×× ×”...</option>
                        ${part.list.map(item => {
                            const isHeader = item.startsWith('---');
                            if (isHeader) return `<option disabled style="font-weight:bold; background:#f1f5f9; color:#1e40af;">${item}</option>`;
                            return `<option value="${item}" ${selectedValue === item ? 'selected' : ''}>${item}</option>`;
                        }).join('')}
                    </select>
                    ${part.note ? `<div class="note">${part.note}</div>` : ''}
                </div>`;
        });
        
        mealHTML += `</div>`;
        container.innerHTML += mealHTML;
    });

    updateStats(dayData);
    renderWeights();
}

function saveSelection(dateKey, selectId, value) {
    if (!appData.days[dateKey]) appData.days[dateKey] = {};
    appData.days[dateKey][selectId] = value;
    saveData();
    updateStats(appData.days[dateKey]);
}

function updateStats(dayData) {
    let totalCal = 0;
    mealsConfig.forEach((meal, mIndex) => {
        // ×‘×•×“×§ ×× × ×‘×—×¨ ××©×”×• ×‘××¨×•×—×” ×”×–×•. ×× ×›×Ÿ - ××—×©×™×‘ ××ª ×”×§×œ×•×¨×™×•×ª ×©×œ ×”××¨×•×—×”
        let isMealActive = false;
        meal.parts.forEach((_, pIndex) => {
            if (dayData[`${mIndex}_${pIndex}`]) isMealActive = true;
        });
        if (isMealActive) totalCal += meal.c;
    });
    document.getElementById('cal-count').innerText = totalCal;
    
    if (appData.weights.length > 0) {
        document.getElementById('last-weight').innerText = appData.weights[0].weight;
        drawChart();
    }
}

// --- × ×™×”×•×œ ××©×§×œ ---
function addW() {
    const input = document.getElementById('w-in');
    const weight = parseFloat(input.value);
    if (!weight) return;
    
    const entry = {
        id: Date.now(),
        date: getDateKey(new Date()),
        weight: weight
    };
    
    appData.weights.unshift(entry); // ××•×¡×™×£ ×œ×”×ª×—×œ×”
    saveData();
    input.value = '';
    renderWeights();
    updateStats(appData.days[getDateKey(currentDate)]);
}

function deleteW(id) {
    if (confirm("×œ××—×•×§ ×©×§×™×œ×” ×–×•?")) {
        appData.weights = appData.weights.filter(w => w.id !== id);
        saveData();
        renderWeights();
        if(appData.weights.length > 0) drawChart();
        else {
             document.getElementById('last-weight').innerText = "--";
             if(window.weightChart) window.weightChart.destroy();
        }
    }
}

function renderWeights() {
    const historyDiv = document.getElementById('w-history');
    historyDiv.innerHTML = appData.weights.map(w => `
        <div class="weight-item">
            <span>ğŸ“… ${w.date}</span>
            <span style="font-weight:bold; color:var(--p);">${w.weight} ×§×´×’</span>
            <button onclick="deleteW(${w.id})" style="background:none; color:#ef4444; border:none; padding:5px; flex:0;">ğŸ—‘ï¸</button>
        </div>
    `).join('');
}

// --- ×’×¨×¤×™× ×•×“×•×—×•×ª ---
function drawChart() {
    const ctx = document.getElementById('wChart').getContext('2d');
    if (window.weightChart) window.weightChart.destroy();
    
    // ×œ×•×§×— ××ª ×”-10 ×©×§×™×œ×•×ª ×”××—×¨×•× ×•×ª ×•×”×•×¤×š ×¡×“×¨ ×œ×ª×¦×•×’×” ×›×¨×•× ×•×œ×•×’×™×ª
    const chartData = [...appData.weights].reverse().slice(-10);
    
    window.weightChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: chartData.map(w => w.date),
            datasets: [{
                label: '××©×§×œ (×§×´×’)',
                data: chartData.map(w => w.weight),
                borderColor: '#1e40af',
                backgroundColor: 'rgba(30, 64, 175, 0.1)',
                tension: 0.3,
                fill: true
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: false } }
        }
    });
}

function openReport() {
    const dateKey = getDateKey(currentDate);
    const dayData = appData.days[dateKey] || {};
    const modalDate = document.getElementById('modal-date');
    const modalBody = document.getElementById('modal-body');
    
    modalDate.innerText = `×¡×™×›×•× ×™×•×: ${dateKey}`;
    
    let html = '';
    mealsConfig.forEach((meal, mIndex) => {
        let mealContent = '';
        let hasContent = false;
        meal.parts.forEach((part, pIndex) => {
            const val = dayData[`${mIndex}_${pIndex}`];
            if (val) {
                mealContent += `<div style="font-size:0.9rem; margin-bottom:4px;">â€¢ ${part.label}: <b>${val}</b></div>`;
                hasContent = true;
            } else {
                mealContent += `<div style="font-size:0.9rem; color:#94a3b8; margin-bottom:4px;">â€¢ ${part.label}: ---</div>`;
            }
        });
        
        html += `
            <div style="margin-bottom:15px; background:#f8fafc; padding:10px; border-radius:8px;">
                <div style="font-weight:bold; color:var(--p); margin-bottom:5px;">${meal.n}</div>
                ${mealContent}
            </div>
        `;
    });
    
    modalBody.innerHTML = html;
    document.getElementById('modal').style.display = 'flex';
}

function changeDate(days) {
    currentDate.setDate(currentDate.getDate() + days);
    initApp();
}

function saveData() {
    localStorage.setItem('heli_yosef_full_v1', JSON.stringify(appData));
}

// ××ª×—×•×œ ×¨××©×•× ×™
initApp();

</script>
</body>
</html>

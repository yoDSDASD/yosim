<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WorkTime Premium</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        :root { --bg: #050505; --card: #121212; --accent: #3d8bff; --text: #ffffff; --text-dim: #a0a0a0; --border: #222; --success: #00e676; }
        * { box-sizing: border-box; font-family: 'Segoe UI', system-ui, -apple-system; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); margin: 0; padding: 15px; min-height: 100vh; display: flex; flex-direction: column; align-items: center; }
        
        /* Splash Screen */
        #welcomeSplash { position: fixed; inset: 0; background: var(--bg); z-index: 2000; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; transition: opacity 0.5s ease; }
        
        /* Login Overlay */
        #loginOverlay { position: fixed; inset: 0; background: var(--bg); z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        
        .card { background: var(--card); width: 100%; max-width: 480px; border-radius: 28px; padding: 25px; border: 1px solid var(--border); margin-bottom: 20px; }
        .timer { font-size: 4rem; font-weight: 200; text-align: center; margin: 20px 0; font-variant-numeric: tabular-nums; letter-spacing: -2px; }
        .status-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; font-size: 0.9rem; }
        
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        button { padding: 18px; border-radius: 16px; border: none; font-weight: 600; cursor: pointer; transition: 0.2s; font-size: 1rem; }
        .btn-in { background: var(--text); color: var(--bg); }
        .btn-out { background: transparent; color: var(--text); border: 1px solid var(--border); }
        .btn-action { background: #1a1a1a; color: var(--text-dim); width: 100%; margin-top: 15px; border: 1px solid var(--border); }
        
        .history-item { display: flex; justify-content: space-between; align-items: center; padding: 16px; background: #181818; border-radius: 14px; margin-bottom: 10px; border: 1px solid var(--border); }
        .action-icon { cursor: pointer; opacity: 0.5; padding: 5px; }
        
        .config-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }
        input { background: #1a1a1a; border: 1px solid var(--border); color: white; padding: 10px; border-radius: 10px; width: 100%; margin-top: 5px; outline: none; }
    </style>
</head>
<body>

<div id="loginOverlay">
    <h1 style="font-weight: 300;">WorkTime PRO</h1>
    <button onclick="login()" style="background:white; color:black; padding:15px 40px; border-radius:14px;">×”×ª×—×‘×¨ ×¢× Google</button>
</div>

<div id="welcomeSplash">
    <div id="greetingText" style="font-size: 3rem; font-weight: 200;"></div>
    <div id="userNameSplash" style="font-size: 1.2rem; color: var(--accent); margin-top: 10px; letter-spacing: 2px;"></div>
</div>

<div class="card">
    <div class="status-header">
        <div id="statusBadge" style="color: var(--text-dim);">×˜×•×¢×Ÿ...</div>
        <div id="monthlyPay" style="font-weight: bold; color: var(--success); font-size: 1.1rem;">â‚ª0</div>
    </div>
    <div class="timer" id="display">00:00:00</div>
    <div class="btn-group">
        <button class="btn-out" onclick="punchOut()">×¡×™×•×</button>
        <button class="btn-in" onclick="punchIn()">×›× ×™×¡×”</button>
    </div>
</div>

<div class="card" style="padding-top: 15px;">
    <div style="font-weight: 600; margin-bottom: 15px; font-size: 0.85rem; color: var(--text-dim);">× ×™×”×•×œ ×©×¢×•×ª</div>
    <div id="historyList"></div>
    <button class="btn-action" onclick="manualAdd()">+ ×”×•×¡×¤×” ×™×“× ×™×ª</button>
</div>

<div class="card">
    <div class="config-grid">
        <div><label style="font-size: 0.7rem;">â‚ª ×œ×©×¢×”</label><input type="number" id="rate" value="50"></div>
        <div><label style="font-size: 0.7rem;">×ª×§×Ÿ ×™×•××™</label><input type="number" id="std" value="9.5"></div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyB6k04PIDrtH0lN1mMH8d4mrQbU_Wd6EPY",
        authDomain: "clooc-87768.firebaseapp.com",
        projectId: "clooc-87768",
        storageBucket: "clooc-87768.firebasestorage.app",
        messagingSenderId: "446568496274",
        appId: "1:446568496274:web:c1aead85e32d21d0e5ba4b"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    let user = null;

    auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);

    async function login() { 
        try { await auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); } catch(e) { alert("×©×’×™××ª ×”×ª×—×‘×¨×•×ª"); }
    }

    auth.onAuthStateChanged(u => {
        if (u) {
            user = u;
            document.getElementById('loginOverlay').style.display = 'none';
            showSplash(u.displayName.split(' ')[0]);
            loadData();
            checkActive();
        }
    });

    function showSplash(name) {
        const hour = new Date().getHours();
        let greeting = "×œ×™×œ×” ×˜×•×‘";
        if (hour >= 5 && hour < 12) greeting = "×‘×•×§×¨ ×˜×•×‘";
        else if (hour >= 12 && hour < 17) greeting = "×¦×”×¨×™×™× ×˜×•×‘×™×";
        else if (hour >= 17 && hour < 21) greeting = "×¢×¨×‘ ×˜×•×‘";

        const splash = document.getElementById('welcomeSplash');
        document.getElementById('greetingText').innerText = greeting;
        document.getElementById('userNameSplash').innerText = name;
        splash.style.display = 'flex';
        
        setTimeout(() => {
            splash.style.opacity = '0';
            setTimeout(() => splash.style.display = 'none', 500);
        }, 2200);
        
        document.getElementById('statusBadge').innerText = `${greeting}, ${name}`;
    }

    function punchIn() {
        if(localStorage.getItem('job_start')) return;
        localStorage.setItem('job_start', new Date().toISOString());
        checkActive();
    }

    async function punchOut() {
        const start = localStorage.getItem('job_start');
        if(!start) return;
        const hours = (new Date() - new Date(start)) / 3600000;
        await saveLog(new Date().toLocaleDateString('he-IL'), hours);
        localStorage.removeItem('job_start');
        location.reload();
    }

    async function saveLog(date, hours) {
        const rate = parseFloat(document.getElementById('rate').value);
        const isThur = new Date().getDay() === 4;
        const standard = isThur ? parseFloat(document.getElementById('std').value) - 1 : parseFloat(document.getElementById('std').value);
        let pay = hours <= standard ? hours * rate : (standard * rate) + ((hours - standard) * rate * 1.25);
        
        await db.collection('users').doc(user.uid).collection('logs').add({
            date, hours: parseFloat(hours.toFixed(2)), pay: Math.round(pay), timestamp: Date.now(), month: new Date().getMonth() + 1
        });
    }

    async function loadData() {
        const snap = await db.collection('users').doc(user.uid).collection('logs').orderBy('timestamp', 'desc').get();
        const logs = snap.docs.map(doc => ({id: doc.id, ...doc.data()}));
        const currentMonth = new Date().getMonth() + 1;
        
        let monthTotal = 0;
        document.getElementById('historyList').innerHTML = logs.slice(0, 5).map(l => {
            if(l.month === currentMonth) monthTotal += l.pay;
            return `
            <div class="history-item">
                <div><small style="color:var(--text-dim)">${l.date}</small><br><b>${l.hours} ×©×¢×•×ª</b></div>
                <div style="display:flex; align-items:center; gap:15px;">
                    <span style="font-weight:600">â‚ª${l.pay}</span>
                    <span class="action-icon" onclick="deleteItem('${l.id}')">ğŸ—‘ï¸</span>
                </div>
            </div>`;
        }).join('');
        document.getElementById('monthlyPay').innerText = `â‚ª${monthTotal}`;
    }

    async function deleteItem(id) {
        if(confirm('×œ××—×•×§ ×¨×©×•××” ×–×•?')) {
            await db.collection('users').doc(user.uid).collection('logs').doc(id).delete();
            loadData();
        }
    }

    function manualAdd() {
        const h = prompt("×›××” ×©×¢×•×ª ×œ×”×•×¡×™×£?");
        if(h && !isNaN(h)) saveLog(new Date().toLocaleDateString('he-IL'), parseFloat(h)).then(loadData);
    }

    let timerInt;
    function checkActive() {
        const start = localStorage.getItem('job_start');
        if(start) {
            document.getElementById('statusBadge').style.color = "var(--success)";
            if(timerInt) clearInterval(timerInt);
            timerInt = setInterval(() => {
                const s = Math.floor((new Date() - new Date(start)) / 1000);
                document.getElementById('display').innerText = new Date(s * 1000).toISOString().substr(11, 8);
            }, 1000);
        }
    }
</script>
</body>
</html>

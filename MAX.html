<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>מכשירי יצור</title>
<style>
  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: "Heebo", sans-serif;
    background: #f6f6f6;
    color: #111;
  }

  .container {
    max-width: 380px;
    margin: 0 auto;
    padding: 2.5vh 4vw;
  }

  .title {
    text-align: center;
    font-size: 1.3rem;
    font-weight: 700;
    margin-bottom: 0.8rem;
  }

  .input-group {
    display: flex;
    flex-direction: column;
    margin-bottom: 0.6rem;
  }

  label {
    font-weight: 600;
    font-size: 0.9rem;
    margin-bottom: 0.25rem;
  }

  input, select {
    padding: 0.4em 0.6em;
    font-size: 1.05rem;
    border: 1px solid #bbb;
    border-radius: 0.3em;
    text-align: center;
    direction: ltr;
    background: #fff;
    transition: 0.15s;
  }

  input:focus, select:focus {
    border-color: #000;
    outline: none;
  }

  .result {
    background: #fff;
    border: 1px solid #999;
    border-radius: 0.4em;
    padding: 0.6em;
    margin-top: 0.8rem;
    font-family: monospace;
    font-size: 1.05rem;
    display: none;
    direction: ltr;
    text-align: left;
  }

  .series {
    margin-top: 0.8rem;
    background: #efefef;
    border-radius: 0.4em;
    padding: 0.6em;
    font-family: monospace;
    font-size: 1.05rem;
    max-height: 200px;
    overflow-y: auto;
    direction: ltr;
    text-align: left;
    display: none;
    border: 1px solid #ccc;
  }

  .highlight { color: #c00000; }

  button {
    width: 100%;
    padding: 0.55em;
    margin-top: 0.6rem;
    font-size: 1.05rem;
    font-weight: 600;
    border: none;
    border-radius: 0.4em;
    cursor: pointer;
    transition: 0.2s;
  }

  .calc-btn {
    background: #000;
    color: #fff;
  }

  .calc-btn:hover { background: #222; }

  .reset-btn {
    background: #d7d7d7;
    color: #000;
  }

  .reset-btn:hover { background: #aaa; }

  @media (max-width: 480px) {
    .container { padding: 2.5vh 5vw; }
    .title { font-size: 1.25rem; }
    input, select { font-size: 1rem; }
    .result, .series { font-size: 1rem; }
  }
</style>
</head>
<body>

<div class="container">
  <div class="title">מכשירי יצור</div>

  <div class="input-group">
    <label for="nominal">NOM</label>
    <input type="number" step="any" id="nominal" inputmode="decimal">
  </div>

  <div class="input-group">
    <label for="upperTol">+TOL</label>
    <input type="number" step="any" id="upperTol" inputmode="decimal">
  </div>

  <div class="input-group">
    <label for="lowerTol">−TOL</label>
    <input type="number" step="any" id="lowerTol" inputmode="decimal">
  </div>

  <button class="calc-btn" onclick="calculate()">חשב</button>
  <button class="reset-btn" onclick="resetCalc()">איפוס</button>

  <div class="result" id="result"></div>

  <div class="input-group" id="stepGroup" style="display:none;">
    <label for="stepValue">קפיצה בין ערכים (מ״מ)</label>
    <select id="stepValue">
      <option value="0.001">0.001</option>
      <option value="0.002">0.002</option>
      <option value="0.005">0.005</option>
      <option value="0.010">0.010</option>
    </select>
  </div>

  <div class="series" id="series"></div>
</div>

<script>
function format(v) {
  return parseFloat(v).toFixed(3);
}

function blurAllInputs() {
  document.querySelectorAll("input, select").forEach(inp => inp.blur());
}

function calculate() {
  blurAllInputs();
  const nominal = parseFloat(document.getElementById("nominal").value);
  const upperInput = document.getElementById("upperTol").value;
  const lowerInput = document.getElementById("lowerTol").value;
  const stepSelect = document.getElementById("stepValue");
  const resultEl = document.getElementById("result");
  const seriesEl = document.getElementById("series");
  const stepGroup = document.getElementById("stepGroup");

  let upper = parseFloat(upperInput);
  let lower = parseFloat(lowerInput);

  if (isNaN(nominal)) {
    resultEl.style.display = "block";
    resultEl.innerHTML = "יש להזין ערך נומינלי תקין";
    seriesEl.style.display = "none";
    stepGroup.style.display = "none";
    return;
  }

  if (isNaN(upper)) upper = 0;
  if (isNaN(lower)) lower = 0;

  const max = nominal + upper;
  const min = nominal - lower;
  const range = max - min;

  let output = "";
  if (upper > 0) output += `<div><strong class="highlight">MAX:</strong> ${format(max)}</div>`;
  if (lower > 0) output += `<div><strong class="highlight">MIN:</strong> ${format(min)}</div>`;
  if (upper > 0 && lower > 0) output += `<hr><div><strong>RANGE:</strong> ${format(range)}</div>`;
  if (!output) output = `<div>אין נתונים להצגה</div>`;

  resultEl.innerHTML = output;
  resultEl.style.display = "block";
  stepGroup.style.display = "block";

  // יצירת סדרה רק אחרי בחירת קפיצה
  stepSelect.onchange = () => {
    const stepInput = parseFloat(stepSelect.value);
    let seriesOutput = "";
    for (let val = min; val <= max + 0.0001; val += stepInput) {
      seriesOutput += format(val) + "<br>";
    }
    seriesEl.innerHTML = seriesOutput;
    seriesEl.style.display = "block";
  };
}

function resetCalc() {
  blurAllInputs();
  ["nominal","upperTol","lowerTol"].forEach(id => document.getElementById(id).value = "");
  document.getElementById("result").innerHTML = "";
  document.getElementById("result").style.display = "none";
  document.getElementById("series").innerHTML = "";
  document.getElementById("series").style.display = "none";
  document.getElementById("stepGroup").style.display = "none";
}
</script>

</body>
</html>
